<!DOCTYPE html>
<html lang='en'>
    <head>
        <meta charset='utf-8' />
        <meta http-equiv='X-UA-Compatible' content='IE=edge' />
        <title>Pairs</title>
        <meta name='viewport' content='width=device-width, initial-scale=1' />
        

        <style>
            :root {
                --accent1: #774936;
                --accent2: #D69F7E;
                --primary-colour: #eeebbd;
                --secondary-colour: #050609;
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            }
            
            * {
                background-color: inherit;
                box-sizing: border-box;
                color: inherit;
                font-family: inherit;
                font-size: 14pt;
                margin-top: 1.5px;
                margin-bottom: 1.5px;
            }
            
            body {
                display: flex;
                flex-direction: column;
                accent-color: var(--accent1);
                background-color: var(--primary-colour);
                color: var(--secondary-colour);
                margin: auto;
                min-width: 85%;
                max-width: 85%;
            }
            
            .menuButton {
                cursor: pointer;
                display: flex;
                flex-grow: 1;
                align-items: center;
                justify-content: center;
                background-color: var(--accent2);
                color: var(--secondary-colour);
                box-shadow: inset 0px 0px 6px var(--accent1);
                border: 2px outset var(--accent1);
                font-weight: 600;
                text-align: center;
                text-decoration: none;
                text-wrap: nowrap;
                overflow: auto;
                padding: 2px;
            }
            
            .menuButton:hover,
            .menuButton:focus {
                background-color: var(--secondary-colour);
                color: var(--primary-colour);
            }
            
            a.button,
            button {
                display: inline-flex;
                background-color: var(--accent2);
                color: var(--secondary-colour);
                box-shadow: inset 0px 0px 6px var(--accent1);
                border: 2px outset var(--accent1);
                border-radius: 7px 0px 7px 0px;
                cursor: pointer;
                padding-inline: 6px;
                align-items: center;
                justify-content: center;
            }
            
            button:disabled {
                background-color: var(--primary-colour);
                color: var(--secondary-colour);
                cursor: not-allowed;
            }
            
            button:focus,
            button:hover {
                background-color: var(--secondary-colour);
                color: var(--primary-colour);
            }
            
            details {
                cursor: default;
                width: 100%;
            }
            
            details > summary {
                background-color: var(--accent2);
                border-left: 2px solid var(--secondary-colour);
                border-top: 2px solid var(--secondary-colour);
                border-radius: 7px 0px 7px 0px;
                cursor: pointer;
                padding: 2px;
            }
            
            details > summary:focus,
            details > summary:hover {
                background-color: var(--secondary-colour);
                color: var(--accent2);
            }
            
            details[open] > summary {
                border-top-left-radius: 0px;
                font-size: 1.05em;
                font-weight: 600;
                padding-bottom: 2px;
                position: sticky;
                top: 0px;
                z-index: 1;
            }
            
            h1 {
                align-self: center;
                border-bottom-style: dotted;
                border-bottom-width: 4px;
                border-color: var(--accent1);
                font-size: 1.6em;
                padding: 0px 4px;
                margin-bottom: 3px;
            }
            
            h1:focus,
            h1:hover {
                border-bottom-style: solid;
                border-bottom-left-radius: 10%;
                border-bottom-right-radius: 10%;
            }
            
            h2 {
                border-bottom-style: ridge;
                border-bottom-width: 3px;
                border-bottom-color: var(--secondary-colour);
                border-radius: 0px 0px 7px 0px;
                padding-left: 4px;
                font-size: 1.4em;
            }
            
            h3 {
                border-bottom-style: ridge;
                border-bottom-width: 3px;
                border-bottom-color: var(--secondary-colour);
                border-radius: 0px 0px 7px 0px;
                padding-left: 4px;
                font-size: 1.3em;
            }
            
            hr {
                border: 2px ridge var(--accent1);
                border-radius: 7px;
                width: 100%;
            }
            
            input {
                border-color: var(--secondary-colour);
                border-style: outset;
                accent-color: var(--accent2);
            }
            
            input::placeholder {
                color: var(--accent1);
            }
            
            input[type='file'] {
                border-style: none;
            }
            
            input[type='number'] {
                border-color: var(--accent1);
                border-radius: 7px 0px 0px 0px;
                text-align: center;
                font-weight: 600;
            }
            
            input[type='number']:focus {
                color: var(--secondary-colour);
                background-color: var(--accent2);
            }
            
            kbd {
                background-color: var(--primary-colour);
                color: var(--secondary-colour);
                border: 1px solid var(--accent1);
                border-radius: 3px;
                border-bottom-width: 2px;
                font-weight: 600;
                padding: 1px 2px;
            }
            
            option:checked {
                background-color: var(--accent2);
            }
            
            select {
                background-color: var(--primary-colour);
                border-color: var(--accent1);
                border-style: inset;
                border-width: 2px;
                color: var(--secondary-colour);
                overflow: auto;
            }
            
            table {
                width: 100%;
                border-collapse: collapse;
            }
            
            td,
            th {
                border-style: inset;
                border-width: 2px;
                padding-inline: 4px;
                text-align: center;
            }
            
            td {
                border-color: var(--secondary-colour);
                font-weight: 600;
            }
            
            td:focus,
            td:hover,
            th:focus,
            th:hover {
                border-color: var(--accent2);
                background-color: var(--secondary-colour);
                color: var(--primary-colour);
                border-style: solid;
            }
            
            th {
                background-image: linear-gradient(45deg, var(--accent2), transparent 20% 80%, var(--accent2));
                border-color: var(--accent1);
                color: var(--accent1);
                font-size: 1.05em;
                font-weight: 600;
            }
            
            textarea {
                border-color: var(--secondary-colour);
                border-style: outset;
                border-width: 2px;
            }
            
            textarea::placeholder {
                color: var(--accent1);
            }
            
            .box {
                display: flex;
                flex-direction: row;
                border-color: var(--accent1);
                border-radius: 7px 0px;
                border-style: outset;
                border-width: 2px;
                padding: 2px;
            }
            
            .box:focus,
            .box:hover {
                background-color: var(--accent1);
                color: var(--primary-colour);
            }
            
            @keyframes tooltipFadeIn {
                from {
                    opacity: 0;
                }
                to {
                    opacity: 0.95;
                }
            }
            
            .modalButtonContainer {
                display: flex;
                flex-direction: row;
                justify-content: space-evenly;
            }
            
            .modalButton {
                border-radius: 2px;
            }
            
            .modalText {
                overflow: auto;
            }
            
            .modalWindow {
                display: none;
                flex-direction: column;
                align-self: center;
                text-align: center;
                box-shadow: 0px 0px 10px 2px var(--secondary-colour);
                border: 4px inset var(--accent1);
                border-radius: 2px;
                padding: 4px;
                max-height: 50vh;
                position: fixed;
                z-index: 9;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
            }
            
            .tooltipParent {
                position: relative;
            }
            
            .tooltipParent:focus > .tooltip,
            .tooltipParent:hover > .tooltip {
                display: flex;
                animation: tooltipFadeIn 0.7s ease;
            }
            
            .tooltip {
                display: none;
                background-color: var(--secondary-colour);
                color: var(--primary-colour);
                opacity: 0.95;
                border-color: var(--accent1);
                border-radius: 7px 0px 7px 0px;
                border-style: outset;
                border-width: 2px;
                padding: 3px;
                position: fixed;
                top: 5px;
                left: 5px;
                z-index: 10;
                min-width: min-content;
                width: max-content;
                max-width: 75vw;
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                font-weight: 600;
                text-align: left;
                text-wrap: wrap;
            }
            
            .tooltip::before {
                content: 'i';
                background-color: var(--primary-colour);
                color: var(--secondary-colour);
                border-radius: 7px 0px 7px 0px;
                margin-right: 4px;
                height: 100%;
                padding-inline: 0.5em;
                font-style: italic;
                font-weight: 600;
            }
            
            #author {
                display: block;
            }

            :root {
                --card-height: calc(80px + 3vmax);
                --card-width: calc(var(--card-height) * 0.7);
                --card-border: calc(var(--card-width) * 0.06);
                --card-shadow: calc(var(--card-border) * 2);
                --card-gap: var(--card-border);
                --card-font: calc(var(--card-width) * 0.6);
                --card-anim-speed: 0.4s;
            }

            .card {
                display: flex;
                align-items: center;
                justify-content: center;
                counter-increment: count 1;
                background-image: linear-gradient(45deg, var(--accent1), transparent 15% 85%, var(--accent1));
                background-color: var(--accent2);
                color: transparent;
                border: var(--card-border) double var(--accent1);
                border-radius: 4px;
                font-size: var(--card-font);
                font-weight: 600;
                height: var(--card-height);
                width: var(--card-width);
                cursor: grab;
                user-select: none;
                -moz-user-select: none;
                -webkit-user-select: none;
                outline-style: none;
                position: relative;
                transition: all var(--card-anim-speed) ease;
            }

            .card:focus,
            .card:hover {
                background-image: linear-gradient(45deg, var(--primary-colour), transparent 15% 85%, var(--primary-colour));
                background-color: var(--accent1);
                color: transparent;
                box-shadow: 0px 0px var(--card-shadow) var(--secondary-colour);
                border-color: var(--primary-colour);
                z-index: 1;
                transform:
                    rotateZ(1deg)
                    scale(1.15)
                    translate(-2%, 8%);
                transition: all var(--card-anim-speed) ease-out;
            }

            .x-ray {
                background-color: var(--accent1);
                border-color: var(--accent2);
            }

            .x-ray:focus,
            .x-ray:hover {
                background-color: rgb(10, 10, 10);
                color: rgb(240, 240, 240);
                border-color: rgb(90, 90, 90);
                opacity: 0.85;
            }

            .open {
                background-image: linear-gradient(45deg, var(--accent2), transparent 15% 85%, var(--accent2));
                background-color: var(--secondary-colour);
                color: var(--primary-colour);
                border-color: var(--accent2);
                cursor: not-allowed;
            }

            .open:focus,
            .open:hover {
                background-image: linear-gradient(45deg, var(--accent1), transparent 15% 85%, var(--accent1));
                background-color: var(--primary-colour);
                color: var(--secondary-colour);
                border-color: var(--accent1);
            }

            .card::before {
                content: counter(count);
                position: absolute;
                left: 0px;
                top: 0px;
                color: var(--secondary-colour);
                font-family: 'Courier New', Courier, monospace;
                font-size: calc(var(--card-font) * 0.45);
                font-weight: 900;
                padding-inline: 2px;
            }

            .card:focus::before,
            .card:hover::before {
                color: var(--primary-colour);
            }

            .open::before {
                color: var(--primary-colour);
            }

            .open:focus::before,
            .open:hover::before {
                color: var(--secondary-colour);
            }

            .x-ray::before {
                color: var(--primary-colour);
            }

            .special::after {
                position: absolute;
                display: flex;
                align-items: baseline;
                justify-content: center;
                right: 0px;
                bottom: 0px;
                background-color: var(--secondary-colour);
                color: var(--primary-colour);
                border-radius: 7px 0px 0px 0px;
                font-family: 'Courier New', Courier, monospace;
                font-size: calc(var(--card-font) * 0.4);
                font-weight: 900;
                padding: 2px;
                height: calc(var(--card-font) * 0.35);
                width: calc(var(--card-font) * 0.35);
                opacity: 0.8;
            }

            .special:focus::after,
            .special:hover::after {
                background-color: var(--primary-colour);
                color: var(--secondary-colour);
            }

            .special.open::after {
                background-color: var(--primary-colour);
                color: var(--secondary-colour);
            }

            .special.open:focus::after,
            .special.open:hover::after {
                background-color: var(--secondary-colour);
                color: var(--primary-colour);
            }

            .plus::after {
                content: '+';
            }

            .minus::after {
                content: '-';
            }

            .multiply::after {
                content: '*';
            }

            .divide::after {
                content: '/'
            }

            .greater-than::after {
                content: '>';
            }

            .less-than::after {
                content: '<';
            }

            .equals::after {
                content: '=';
            }

            .x-ray:focus::before,
            .x-ray:hover::before {
                color: rgb(230, 230, 230);
            }

            .hint-card {
                position: relative;
            }

            .hint-card:focus > .hint,
            .hint-card:hover > .hint {
                display: flex;
            }

            .hint {
                display: none;
                position: absolute;
                bottom: -20%;
                align-items: center;
                justify-content: center;
                background-color: #dddddd;
                color: #1e00ff;
                box-shadow: 0px 0px 4px #000000;
                border: 4px outset #ffffff;
                border-radius: 2px;
                font-family: 'Courier New', Courier, monospace;
                font-size: calc(var(--card-font) * 0.75);
                font-weight: 900;
                padding: 2px;
                height: calc(var(--card-font) * 0.9);
                width: calc(var(--card-font) * 0.9);
                min-width: fit-content;
            }

            #cards {
                border-radius: 0px 0px 0px 7px;
                width: 100%;
            }

            #grid {
                display: flex;
                flex-wrap: wrap;
                align-self: center;
                justify-content: center;
                column-gap: var(--card-gap);
            }

            #grid-size {
                width: 100%;
            }

            @keyframes win-blink {
                25% {
                    box-shadow: inset 0px 0px 15px var(--accent1);
                }
                50% {
                    box-shadow: none;
                }
                75% {
                    box-shadow: inset 0px 0px 15px var(--secondary-colour);
                }
            }

            #grid-victory {
                align-self: center;
                text-align: center;
                font-size: 1.5em;
                font-weight: 600;
                background-image: linear-gradient(315deg, var(--accent1), transparent 15% 85%, var(--accent1));
                border: 2px solid var(--accent1);
                border-radius: 7px 7px 0px 0px;
                padding: 2px;
                width: 100%;
                animation: win-blink 12s ease alternate infinite;
            }

            #grid-win {
                display: none;
                flex-direction: column;
            }

            #score-div {
                display: flex;
                column-gap: 4px;
                justify-content: center;
                position: sticky;
                bottom: 0px;
                background-image: linear-gradient(315deg, var(--accent1), transparent 15% 85%, var(--accent1));
                border: 2px groove var(--accent1);
                border-radius: 7px 7px 0px 0px;
                font-weight: 600;
                opacity: 0.9;
                transition: all 0.6s ease;
            }

            #score-count-label,
            #score-count {
                background-color: transparent;
            }

            .not-enough-score {
                background-color: var(--secondary-colour);
                color: var(--primary-colour);
                transition: all 0.6s ease;
            }

            .bonus {
                background-image: linear-gradient(20deg, var(--accent1), transparent 20% 80%, var(--accent1));
                background-color: var(--secondary-colour);
                color: var(--primary-colour);
                border: var(--card-border) double var(--accent2);
                border-radius: 4px;
                font-weight: 600;
                padding-inline: 6px;
                user-select: none;
                -moz-user-select: none;
                -webkit-user-select: none;
            }

            .bonus:focus,
            .bonus:hover {
                background-image: linear-gradient(20deg, var(--accent2), transparent 20% 80%, var(--accent2));
                background-color: var(--primary-colour);
                color: var(--secondary-colour);
                border-color: var(--accent1);
            }

            #rules-general {
                text-align: justify;
                text-indent: 16px;
            }

            #special-help {
                display: flex;
                flex-direction: column;
                align-items: center;
            }

            #special-help-header {
                font-weight: 600;
            }

            .special-help-symbol {
                display: flex;
                align-items: center;
                justify-content: center;
                background-color: var(--secondary-colour);
                color: var(--primary-colour);
                border-radius: 7px 0px 0px 0px;
                font-family: 'Courier New', Courier, monospace;
                font-weight: 900;
                height: calc(var(--card-font) * 0.5);
                width: calc(var(--card-font) * 0.5);
                opacity: 0.8;
            }

            .special-help-item {
                display: flex;
                align-items: center;
                margin-left: 8px;
            }

            .special-help-description {
                font-family: 'Courier New', Courier, monospace;
                font-weight: 900;
            }
        </style>
    </head>
    <body>
        <h1 id='game-name'>Pairs</h1>

        <!-- Settings -->
        <details id='settings'>
            <summary id='settings-summary'>Settings</summary>
        </details>

        <!-- Page main body -->
        
        <!-- Save & Load buttons -->
        <div style='display: flex; column-gap: 4px;'>
            <!-- Load button -->
            <button
                id='loadPackButton'
                class='menuButton tooltipParent'
                onclick='document.getElementById("loadPackInput").click()'
                style='border-radius: 7px 0px 0px 0px;'
            >
                &#128193; Load
                <span class='tooltip'>Load pack from .txt file</span>
            </button>
            <input
                id='loadPackInput'
                type='file'
                accept='.txt'
                onchange='loadPack()'
                style='display: none;'
            >
            </input>

            <!-- Save button -->
            <a
                id='savePackButton'
                href=''
                class='menuButton tooltipParent'
                onclick='savePack()'
                style='border-radius: 0px 7px 0px 0px;'
            >
                &#128190; Save
                <span class='tooltip'>Save pack to .txt file</span>
            </a>
        </div>

        <!-- Cards -->
        <input id='cards' type='text' placeholder="Cards' symbols (separated by space)">

        <!-- Start button -->
        <button id='start' onclick='fillGrid()'>Start</button>

        <!-- Grid size slider -->
        <div id='grid-size-div' class='tooltipParent'>
            <input id='grid-size' type='range' min='30' max='100' step='5' value='100' list='slider'>
            <span class='tooltip' id='grid-size-tooltip'>Grid size slider</span>
        </div>

        <!-- Values of grid size slider -->
        <datalist id='slider'>
            <option value='40'></option>
            <option value='50'></option>
            <option value='60'></option>
            <option value='70'></option>
            <option value='80'></option>
            <option value='90'></option>
        </datalist>

        <!-- Victory text & Statistics -->
        <div id='grid-win' tabindex='0'>
            <span id='grid-victory' tabindex='0'>Victory!</span>
            
            <!-- End stats -->
            <table id='grid-win-stats'>
                <th id='grid-win-stats-label' colspan='2' tabindex='0'>
                    Statistics
                </th>

                <tr>
                    <td>
                        <span id='grid-win-time-label' tabindex='0'>Time (min:sec)</span>
                    </td>
                    <td>
                        <span id='grid-win-time' tabindex='0'>00:00</span>
                    </td>
                </tr>

                <tr>
                    <td>
                        <span id='grid-win-mistakes-label' tabindex='0'>Mistakes</span>
                    </td>
                    <td>
                        <span id='grid-win-mistakes' tabindex='0'>0</span>
                    </td>
                </tr>

                <tr>
                    <td>
                        <span id='grid-win-loss-label' tabindex='0'>Points lost</span>
                    </td>
                    <td>
                        <span id='grid-win-loss' tabindex='0'>0</span>
                    </td>
                </tr>

                <tr>
                    <td>
                        <span id='grid-win-gain-label' tabindex='0'>Points earned</span>
                    </td>
                    <td>
                        <span id='grid-win-gain' tabindex='0'>0</span>
                    </td>
                </tr>

                <tr>
                    <td>
                        <span id='grid-win-bonuses-label' tabindex='0'>Bonuses used</span>
                    </td>
                    <td>
                        <span id='grid-win-bonuses' tabindex='0'>0</span>
                    </td>
                </tr>
            </table>
        </div>

        <!-- Grid -->
        <div id='grid'></div>

        <!-- Invisible welcome message -->
        <p id='welcome-msg' style='display: none;'>WELCOME TO PAIRS!</p>

        <!-- Score -->
        <div id='score-div'>
            <label id='score-count-label' for='score-count'>Score:</label>
            <span id='score-count'>0</span>
        </div>

        <!-- Bonuses shop -->
        <details id='bonuses-shop'>
            <summary id='bonuses-shop-summary'>Bonuses shop</summary>

            <ul>
                <li>
                    <button
                        id='bonus-remove-special'
                        class='bonus tooltipParent'
                        onclick='buyBonus("bonus-remove-special")'
                    >
                        Nothing extra
                        <span class='tooltip'>
                            Remove all special effects from cards.
                        </span>
                    </button>
                </li>

                <li>
                    <button
                        id='bonus-indifference'
                        class='bonus tooltipParent'
                        onclick='buyBonus("bonus-indifference")'
                    >
                        Indifference
                        <span class='tooltip'>
                            Turn all special cards into type =.
                        </span>
                    </button>
                </li>

                <li>
                    <button
                        id='bonus-chance'
                        class='bonus tooltipParent'
                        onclick='buyBonus("bonus-chance")'
                    >
                        Power of chance
                        <span class='tooltip'>
                            Remove all special effects from cards and pick new ones randomly.
                        </span>
                    </button>
                </li>

                <li>
                    <button
                        id='bonus-experimenter'
                        class='bonus tooltipParent'
                        onclick='buyBonus("bonus-experimenter")'
                    >
                        Experimenter
                        <span class='tooltip'>
                            Turn all special cards into type >.
                        </span>
                    </button>
                </li>

                <li>
                    <button
                        id='bonus-random-x-ray'
                        class='bonus tooltipParent'
                        onclick='buyBonus("bonus-random-x-ray")'
                    >
                        Random X-ray
                        <span class='tooltip'>
                            From time to time a random ordinary card receives X-ray effect for 3 seconds: reveal it on hovering.
                        </span>
                    </button>
                </li>

                <li>
                    <button
                        id='bonus-x-ray'
                        class='bonus tooltipParent'
                        onclick='buyBonus("bonus-x-ray")'
                    >
                        Full X-ray
                        <span class='tooltip'>
                            X-ray mode: reveal any card on hovering. Disables after choosing a card.
                        </span>
                    </button>
                </li>

                <li>
                    <button
                        id='bonus-optimist'
                        class='bonus tooltipParent'
                        onclick='buyBonus("bonus-optimist")'
                    >
                        Optimist
                        <span class='tooltip'>
                            Turn all special cards into type +.
                        </span>
                    </button>
                </li>

                <li>
                    <button
                        id='bonus-minesweeper'
                        class='bonus tooltipParent'
                        onclick='buyBonus("bonus-minesweeper")'
                    >
                        Minesweeper
                        <span class='tooltip'>
                            Random ordinary cards show horizontal distance to their pairs on hover.
                        </span>
                    </button>
                </li>
            </ul>
        </details>

        <!-- Game rules -->
        <details>
            <summary id='rules-summary'>Rules</summary>

            <p id='rules-general'>Find pairs of cards by trying to memorise as many as you can in the beginning of the game and by careful guessing. A right guess gives you a reward (<b>2</b> points), while a wrong one results in a penalty (<b>-1</b> point). Use points to buy <b>bonuses</b> that make the game a bit easier. And pay attention to <b>special cards</b>, they have some additional effects (see below).</p>

            <h3 id='rules-special-cards'>Special cards</h3>

            <div id='special-help'>
                <p id='special-help-header'>Card | Reward | Penalty</p>
                <div id='special-list'></div>
            </div>
        </details>

        <p id='author' class='box' style='font-style: italic'>
            Made by Vitaly Pavlovich Ulyanov.
        </p>
        <!-- Автор — Виталий Павлович Ульянов. -->

        <script>
            /**
             * JavaScript logic for HTML programmes by Vital (Vitaly Pavlovich Ulyanov)
             */
            
            // Stored values and style variables
            let storedPrimaryColour =
                localStorage.getItem('--primary-colour') ??
                getComputedStyle(document.body).getPropertyValue('--primary-colour');
            let storedSecondaryColour =
                localStorage.getItem('--secondary-colour') ??
                getComputedStyle(document.body).getPropertyValue('--secondary-colour');
            let storedAccentColour1 =
                localStorage.getItem('--accent1') ??
                getComputedStyle(document.body).getPropertyValue('--accent1');
            let storedAccentColour2 =
                localStorage.getItem('--accent2') ??
                getComputedStyle(document.body).getPropertyValue('--accent2');
            
            document.body.style.setProperty('--primary-colour', storedPrimaryColour);
            document.body.style.setProperty('--secondary-colour', storedSecondaryColour);
            document.body.style.setProperty('--accent1', storedAccentColour1);
            document.body.style.setProperty('--accent2', storedAccentColour2);
            
            /** @type {HTMLDetailsElement} */
            let settings = document.getElementById('settings');
            
            // Append settings with unified ones
            let fullscreen = settings.parentElement.appendChild(
                document.createElement('button')
            );
            let font = settings.appendChild(document.createElement('div'));
            let setDiv = settings.appendChild(document.createElement('div'));
            let primDiv = setDiv.appendChild(document.createElement('div'));
            let secDiv = setDiv.appendChild(document.createElement('div'));
            let acc1Div = setDiv.appendChild(document.createElement('div'));
            let acc2Div = setDiv.appendChild(document.createElement('div'));
            let load = settings.appendChild(document.createElement('div'));
            let save = settings.appendChild(document.createElement('a'));
            
            setDiv.style.display = 'flex';
            setDiv.style.flexWrap = 'wrap';
            
            //#region Fullscreen button
            const up = '&#9650;';
            const down = '&#9660;';
            
            fullscreen.id = 'fullscreenButton';
            fullscreen.classList = 'tooltipParent';
            fullscreen.innerHTML = up;
            fullscreen.style.fontWeight = 600;
            fullscreen.style.borderWidth = 0;
            fullscreen.style.opacity = '0.9';
            fullscreen.style.position = 'fixed';
            fullscreen.style.paddingInline = '2px';
            fullscreen.style.top = '5px';
            fullscreen.style.right = '5px';
            fullscreen.addEventListener('click', function () {
                let page = document.documentElement;
                if (document.fullscreenElement) {
                    if (document.exitFullscreen) document.exitFullscreen();
                } else {
                    if (page.requestFullscreen) page.requestFullscreen();
                }
            });
            
            let fullscreenTooltip = document.createElement('span');
            fullscreenTooltip.className = 'tooltip';
            fullscreenTooltip.textContent = 'Fullscreen';
            
            fullscreen.appendChild(fullscreenTooltip);
            
            document.addEventListener('fullscreenchange', function () {
                if (document.fullscreenElement) fullscreen.innerHTML = down;
                else fullscreen.innerHTML = up;
                fullscreen.appendChild(fullscreenTooltip);
            });
            //#endregion
            
            //#region Font
            let fontDiv = font.appendChild(document.createElement('div'));
            fontDiv.style.display = 'flex';
            fontDiv.style.alignItems = 'baseline';
            fontDiv.style.columnGap = '4px';
            
            let fontLabel = fontDiv.appendChild(document.createElement('label'));
            let fontInput = fontDiv.appendChild(document.createElement('input'));
            
            fontLabel.id = 'fontLabel';
            fontLabel.htmlFor = 'fontInput';
            fontLabel.textContent = 'Font';
            
            fontInput.id = 'fontInput';
            fontInput.type = 'text';
            fontInput.placeholder = 'Type a font\'s name and press Enter';
            fontInput.style.width = '100%';
            fontInput.addEventListener('change', function () {
                localStorage.setItem('pageFont', this.value);
                loadFont();
            });
            //#endregion
            
            //#region Primary colour
            primDiv.style.display = 'flex';
            primDiv.style.minWidth = '50%';
            primDiv.style.alignItems = 'center';
            primDiv.style.columnGap = '4px';
            
            let primInput = primDiv.appendChild(document.createElement('input'));
            primInput.id = 'primCol';
            primInput.type = 'color';
            primInput.value = storedPrimaryColour;
            primInput.addEventListener('input', function () {
                colourChange('primary', this.value);
            });
            
            let primLabel = primDiv.appendChild(document.createElement('label'));
            primLabel.id = 'primLabel';
            primLabel.htmlFor = primInput.id;
            primLabel.textContent = 'Background colour';
            primLabel.style.verticalAlign = 'center';
            //#endregion
            
            //#region Secondary colour
            secDiv.style.display = 'flex';
            secDiv.style.alignItems = 'center';
            secDiv.style.columnGap = '4px';
            
            let secInput = secDiv.appendChild(document.createElement('input'));
            secInput.id = 'secCol';
            secInput.type = 'color';
            secInput.value = storedSecondaryColour;
            secInput.addEventListener('input', function () {
                colourChange('secondary', this.value);
            });
            
            let secLabel = secDiv.appendChild(document.createElement('label'));
            secLabel.id = 'secLabel';
            secLabel.htmlFor = secInput.id;
            secLabel.textContent = 'Text colour';
            secLabel.style.verticalAlign = 'center';
            //#endregion
            
            //#region Accent colour 1
            acc1Div.style.display = 'flex';
            acc1Div.style.minWidth = '50%';
            acc1Div.style.alignItems = 'center';
            acc1Div.style.columnGap = '4px';
            
            let acc1Input = acc1Div.appendChild(document.createElement('input'));
            acc1Input.id = 'acc1Col';
            acc1Input.type = 'color';
            acc1Input.value = storedAccentColour1;
            acc1Input.addEventListener('input', function () {
                colourChange('accent1', this.value);
            });
            
            let acc1Label = acc1Div.appendChild(document.createElement('label'));
            acc1Label.id = 'acc1Label';
            acc1Label.htmlFor = acc1Input.id;
            acc1Label.textContent = 'Accent colour 1';
            acc1Label.style.verticalAlign = 'center';
            //#endregion
            
            //#region Accent colour 2
            acc2Div.style.display = 'flex';
            acc2Div.style.alignItems = 'center';
            acc2Div.style.columnGap = '4px';
            
            let acc2Input = acc2Div.appendChild(document.createElement('input'));
            acc2Input.id = 'acc2Col';
            acc2Input.type = 'color';
            acc2Input.value = storedAccentColour2;
            acc2Input.addEventListener('input', function () {
                colourChange('accent2', this.value);
            });
            
            let acc2Label = acc2Div.appendChild(document.createElement('label'));
            acc2Label.id = 'acc2Label';
            acc2Label.htmlFor = acc2Input.id;
            acc2Label.textContent = 'Accent colour 2';
            acc2Label.style.verticalAlign = 'center';
            //#endregion
            
            //#region Load button
            load.className = 'box';
            load.style.display = 'flex';
            load.style.flexWrap = 'wrap';
            load.style.alignItems = 'center';
            load.style.justifyContent = 'space-between';
            
            let loadLabel = load.appendChild(document.createElement('label'));
            loadLabel.id = 'loadLabel';
            loadLabel.htmlFor = 'loadColoursButton';
            loadLabel.innerHTML = '&#128193; Load colours';
            loadLabel.style.flexGrow = 1;
            loadLabel.style.cursor = 'pointer';
            
            let loadInput = load.appendChild(document.createElement('input'));
            loadInput.id = 'loadColoursButton';
            loadInput.type = 'file';
            loadInput.accept = '.json';
            loadInput.style.display = 'none';
            loadInput.addEventListener('change', loadColours);
            //#endregion
            
            //#region Save button
            save.id = 'saveColoursButton';
            save.href = '';
            save.download = 'ColourScheme.json';
            save.className = 'box';
            save.innerHTML = '&#128190; Save colours';
            save.style.textDecoration = 'none';
            save.addEventListener('click', saveColours);
            //#endregion
            
            //#region Export texts for translation
            let exportLang = settings.appendChild(document.createElement('a'));
            
            exportLang.id = 'exportLang';
            exportLang.href = '';
            exportLang.download = 'TranslationTemplate.json';
            exportLang.className = 'box';
            exportLang.innerHTML = '&#127760; Export texts for translation';
            exportLang.style.textDecoration = 'none';
            exportLang.addEventListener('click', exportTranslationTemplate);
            //#endregion
            
            function colourChange(colourType, colour) {
                switch (colourType) {
                    case 'primary':
                        document.body.style.setProperty('--primary-colour', colour);
                        localStorage.setItem('--primary-colour', colour);
                        break;
                    case 'secondary':
                        document.body.style.setProperty('--secondary-colour', colour);
                        localStorage.setItem('--secondary-colour', colour);
                        break;
                    case 'accent1':
                        document.body.style.setProperty('--accent1', colour);
                        localStorage.setItem('--accent1', colour);
                        break;
                    case 'accent2':
                        document.body.style.setProperty('--accent2', colour);
                        localStorage.setItem('--accent2', colour);
                        break;
                    default:
                        break;
                }
            }
            
            /**
             * @typedef {Object} ColourScheme
             * @property {string} primary
             * @property {string} secondary
             * @property {string} accent1
             * @property {string} accent2
             */
            
            function saveColours() {
                /** @type {ColourScheme}  */
                let colours = {
                    primary: document.body.style.getPropertyValue('--primary-colour'),
                    secondary: document.body.style.getPropertyValue('--secondary-colour'),
                    accent1: document.body.style.getPropertyValue('--accent1'),
                    accent2: document.body.style.getPropertyValue('--accent2'),
                };
                let data = encodeURIComponent(JSON.stringify(colours, undefined, 2));
                saveColoursButton.href = `data:text/plain;charset=utf-8,${data}`;
            }
            
            /**
             * @typedef {Object} LangElement
             * @property {string} id
             * @property {string} textContent
             * @property {string} placeholder
             * @property {string[]} childNodesTexts
             */
            function exportTranslationTemplate() {
                /** @type {LangElement[]} */
                let elements = [];
            
                document.querySelectorAll('body *').forEach((e) => {
                    if (e.tagName !== 'DIV'
                        && e.tagName !== 'DETAILS'
                        && e.tagName !== 'TABLE'
                        && e.id
                        && e.id !== 'lang'
                    ) {
                        /** @type {LangElement} */
                        let newEl = {};
            
                        newEl.id = e.id;
            
                        if (e.childNodes) {
                            newEl.childNodesTexts = [];
            
                            for (let n of e.childNodes) {
                                if (n.textContent && n.textContent.trim() !== '') {
                                    newEl.childNodesTexts.push(n.textContent.trim());
                                }
                            }
                        } else {
                            if (e.textContent) {
                                newEl.textContent = e.textContent;
                            }
                        }
            
                        if (e.placeholder) {
                            newEl.placeholder = e.placeholder;
                        }
            
                        if (newEl.textContent
                            || newEl.placeholder
                            || newEl?.childNodesTexts.length > 0
                        ) {
                            elements.push(newEl);
                        }
                    }
                });
            
                let data = encodeURIComponent(JSON.stringify(elements, undefined, 4));
                exportLang.href = `data:text/plain;charset=utf-8,${data}`;
            }
            
            async function loadColours() {
                await loadColoursButton.files[0].text().then((content) => {
                    try {
                        /** @type {ColourScheme} */
                        let data = JSON.parse(content);
                        if (data) {
                            if (data.primary) {
                                colourChange('primary', data.primary);
                                primInput.value = data.primary;
                            }
                            if (data.secondary) {
                                colourChange('secondary', data.secondary);
                                secInput.value = data.secondary;
                            }
                            if (data.accent1) {
                                colourChange('accent1', data.accent1);
                                acc1Input.value = data.accent1;
                            }
                            if (data.accent2) {
                                colourChange('accent2', data.accent2);
                                acc2Input.value = data.accent2;
                            }
                        }
                    } catch (error) {
                        alert(
                            `Ошибка при чтении файла цветов: ${error}`
                        );
                    }
                });
            }
            
            function loadFont() {
                let font = localStorage.getItem('pageFont');
                document.getElementById('fontInput').value = font;
                document.documentElement.style.fontFamily = font;
            }
            
            /**
             * @typedef {Object} Translation
             * @property {string} name
             * @property {string[]} langTags
             * @property {LangElement[]} elements
             */
            /**
             * @param {Translation[]} languages
             */
            function generateLanguagesList(languages) {
                /** @type {HTMLSelectElement} */
                let list = document.body.insertBefore(
                    document.createElement('select'), settings
                );
                list.id = 'lang';
                list.style.borderRadius = '7px 0px 0px 7px';
                list.addEventListener('change', function (event) {
                    selectLanguage(languages, true);
                });
            
                for (let l of languages) {
                    /** @type {HTMLOptionElement} */
                    let option = list.appendChild(
                        document.createElement('option')
                    );
                    option.value = l.name;
                    option.textContent = l.name;
                }
            
                selectLanguage(languages, false);
            }
            
            /**
             * @param {Translation[]} languages
             * @param {boolean} fromMenu
             */
            function selectLanguage(languages, fromMenu) {
                /** @type {HTMLSelectElement} */
                let menu = document.getElementById('lang');
                /** @type {string} */
                let selection = undefined;
            
                if (fromMenu === false) {
                    if (localStorage.getItem('lang')) {
                        selection = localStorage.getItem('lang');
                        menu.value = selection;
                    } else if (navigator.language) {
                        // Iterate over translations
                        for (const l of languages) {
                            // If the valid option is finally found, exit
                            if (selection) {
                                break;
                            } else if (l.langTags) {
                                // Otherwise iterate over the tags and
                                // compare them to the browser language
                                for (const t of l.langTags) {
                                    if (navigator.language === t) {
                                        menu.value = l.name;
                                        selection = l.name;
                                        break;
                                    }
                                }
                            }
                        }
                    }
                } else {
                    selection = menu.value;
                }
            
                if (selection) {
                    /** @type {Translation} */
                    let translation = {};
            
                    for (const l of languages) {
                        if (l.name === selection) {
                            translation = l;
                            break;
                        }
                    }
            
                    if (translation) {
                        localStorage.setItem('lang', selection);
            
                        for (const e of translation.elements) {
                            let target = document.getElementById(e.id);
            
                            if (target) {
                                if (e.textContent) {
                                    target.textContent = e.textContent;
                                }
            
                                if (e.placeholder) {
                                    target.placeholder = e.placeholder;
                                }
            
                                if (e.childNodesTexts) {
                                    /** @type {number} */
                                    let index = 0;
            
                                    for (const c of target.childNodes) {
                                        if (c.textContent
                                            && c.textContent.trim() !== ''
                                            && e.childNodesTexts[index]
                                        ) {
                                            c.textContent = e.childNodesTexts[index];
                                            index ++;
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
            
            loadFont();

        </script>
        <script>
            // Elements
            /** @type {HTMLInputElement} */
            let loadPackInput = document.getElementById('loadPackInput');
            /** @type {HTMLAnchorElement} */
            let savePackButton = document.getElementById('savePackButton');
            /** @type {HTMLButtonElement} */
            let startButton = document.getElementById('start');
            /** @type {HTMLInputElement} */
            let cardsInput = document.getElementById('cards');
            /** @type {HTMLSpanElement} */
            let win = document.getElementById('grid-win');
            /** @type {HTMLSpanElement} */
            let winTime = document.getElementById('grid-win-time');
            /** @type {HTMLSpanElement} */
            let winMistakes = document.getElementById('grid-win-mistakes');
            /** @type {HTMLSpanElement} */
            let winBonuses = document.getElementById('grid-win-bonuses');
            /** @type {HTMLSpanElement} */
            let winLost = document.getElementById('grid-win-loss');
            /** @type {HTMLSpanElement} */
            let winEarned = document.getElementById('grid-win-gain');
            /** @type {HTMLDivElement} */
            let grid = document.getElementById('grid');
            /** @type {HTMLInputElement} */
            let gridSize = document.getElementById('grid-size');
            /** @type {HTMLDivElement} */
            let scoreDiv = document.getElementById('score-div');
            /** @type {HTMLSpanElement} */
            let scoreCount = document.getElementById('score-count');
            /** @type {HTMLDetailsElement} */
            let shop = document.getElementById('bonuses-shop');

            // Other variables
            /** @type {HTMLDivElement} */
            let lastOpenCard = undefined;
            /** @type {boolean} */
            let isGameInProcess = false;
            /** @type {boolean} */
            let xRay = false;
            /** @type {number} */
            let hideSpeed;
            /** @type {number} */
            let mistakesCount;
            /** @type {number} */
            let bonusesCount;
            /** @type {number} */
            let pointsLost;
            /** @type {number} */
            let pointsEarned;
            /** @type {number} */
            let timerStart;
            /** @type {number} */
            let timerEnd;
            /** @type {number} */
            let randomXRayInterval;
            /** @type {number} */
            let score = parseInt(localStorage.getItem('score')) || 0;

            // Special cards
            /**
             * @typedef {Object} SpecialCard
             * @property {string} name
             * @property {string} symbol
             * @property {number} mistakeAdd
             * @property {number} correctAdd
             * @property {number} mistakeMult
             * @property {number} correctMult
             * @property {string} mistakeDescr
             * @property {string} correctDescr
            */
            /** @type {SpecialCard[]} */
            let specialCards = [
                {
                    name: 'plus',
                    symbol: '+',
                    mistakeAdd: -1,
                    correctAdd: 3,
                    mistakeMult: 1,
                    correctMult: 1,
                    mistakeDescr: '-1',
                    correctDescr: '+3'
                },
                {
                    name: 'minus',
                    symbol: '-',
                    mistakeAdd: -3,
                    correctAdd: 1,
                    mistakeMult: 1,
                    correctMult: 1,
                    mistakeDescr: '-3',
                    correctDescr: '+1'
                },
                {
                    name: 'multiply',
                    symbol: '*',
                    mistakeAdd: -1,
                    correctAdd: 2,
                    mistakeMult: 2,
                    correctMult: 2,
                    mistakeDescr: '*2',
                    correctDescr: '*2'
                },
                {
                    name: 'greater-than',
                    symbol: '>',
                    mistakeAdd: 0,
                    correctAdd: 2,
                    mistakeMult: 0,
                    correctMult: 1,
                    mistakeDescr: '*0',
                    correctDescr: '+2'
                },
                {
                    name: 'less-than',
                    symbol: '<',
                    mistakeAdd: -2,
                    correctAdd: 0,
                    mistakeMult: 1,
                    correctMult: 0,
                    mistakeDescr: '-2',
                    correctDescr: '*0'
                },
                {
                    name: 'equals',
                    symbol: '=',
                    mistakeAdd: 0,
                    correctAdd: 0,
                    mistakeMult: 0,
                    correctMult: 0,
                    mistakeDescr: '*0',
                    correctDescr: '*0'
                }
            ];
            /** @type {string[]} */
            let specialClasses = specialCards.map(c => c.name);

            // Bonuses
            /** @typedef {Object} Bonus
             * @property {string} name
             * @property {number} cost
             * @property {Function} func
            */
            /** @type {Bonus[]} */
            let bonuses = [
                {
                    name: 'bonus-remove-special',
                    cost: 8,
                    func: function () {
                        removeSpecialCards();
                    }
                },
                {
                    name: 'bonus-indifference',
                    cost: 10,
                    func: function () {
                        replaceSpecialCards('equals');
                    }
                },
                {
                    name: 'bonus-chance',
                    cost: 12,
                    func: function () {
                        removeSpecialCards();
                        createSpecialCards();
                    }
                },
                {
                    name: 'bonus-experimenter',
                    cost: 14,
                    func: function () {
                        replaceSpecialCards('greater-than');
                    }
                },
                {
                    name: 'bonus-random-x-ray',
                    cost: 16,
                    func: function () {
                        randomXRayInterval = setInterval(() => {
                            if (!isGameInProcess) return;
                            
                            /** @type {HTMLDivElement[]} */
                            let cards = Array.from(grid.children).filter(c => 
                                !c.classList.contains('open')
                                && !c.classList.contains('x-ray')
                                && !c.classList.contains('special')
                            );

                            if (cards.length === 0) return;

                            /** @type {number} */
                            let random = Math.floor(Math.random() * cards.length);

                            cards[random].classList.add('x-ray');
                            setTimeout(() => {
                                cards[random].classList.remove('x-ray')
                            }, 3000);
                        }, 7000);
                    }
                },
                {
                    name: 'bonus-x-ray',
                    cost: 20,
                    func: function () {
                        xRay = true;
                        switchXRay();
                    }
                },
                {
                    name: 'bonus-optimist',
                    cost: 25,
                    func: function () {
                        replaceSpecialCards('plus');
                    }
                },
                {
                    name: 'bonus-minesweeper',
                    cost: 30,
                    func: function () {
                        /** @type {HTMLDivElement[]} */
                        let cards = Array.from(grid.children);

                        for (let i = 0; i < cards.length; i++) {
                            /** @type {number} */
                            let random = Math.floor(Math.random() * 3);

                            if (random === 0
                                && !cards[i].classList.contains('special')
                                && !cards[i].classList.contains('open')
                            ) {
                                for (let j = 0; j < cards.length; j++) {
                                    if (cards[j].dataset.icon === cards[i].dataset.icon
                                        && cards[j] !== cards[i]
                                    ) {
                                        cards[i].classList.add('hint-card');

                                        let hint = cards[i].appendChild(
                                            document.createElement('div')
                                        );
                                        hint.classList.add('hint');
                                        hint.textContent = Math.abs(j - i);
                                        break;
                                    }
                                }
                            }
                        }
                    }
                }
            ];
            
            // Add prices to bonuses in the shop
            for (let bonus of bonuses) {
                /** @type {HTMLButtonElement} */
                let button = document.getElementById(bonus.name);

                if (button) {
                    button.firstChild.textContent += ` [${bonus.cost}]`;
                }
            }

            // Restore saved data
            cardsInput.value = localStorage.getItem('cards') ?? '';
            gridSize.value = localStorage.getItem('gridSize') ?? '100';
            grid.style.width = `${gridSize.value}%`;
            scoreCount.textContent = score;

            // Show the welcome message
            for (let s of document.getElementById('welcome-msg').textContent) {
                let card = grid.appendChild(
                    document.createElement('div')
                );

                card.classList.add('card', 'open');
                card.textContent = s;
            }

            // General events
            cardsInput.addEventListener('input', function (event) {
                localStorage.setItem('cards', cardsInput.value);
            });

            gridSize.addEventListener('input', function (event) {
                localStorage.setItem('gridSize', gridSize.value);
                grid.style.width = `${gridSize.value}%`;
            });

            // Functions
            async function loadPack() {
                await loadPackInput.files[0].text().then(c => {
                    localStorage.setItem('cards', c);
                    cardsInput.value = c;
                    fillGrid();
                });
            }

            function savePack() {
                let data = encodeURIComponent(cardsInput.value);
                savePackButton.download = 'Pack.txt';
                savePackButton.href = `data:text/plain;charset=utf-8,${data}`;
            }

            function fillGrid() {
                /** @type {string[]} */
                let cards = cardsInput.value.trim().split(' ');
                if (cards.length < 2) return;

                // Clean up before the new game
                clearInterval(randomXRayInterval);
                hideSpeed = cards.length * 1000;
                win.style.display = 'none';
                lastOpenCard = undefined;
                isGameInProcess = false;
                mistakesCount = 0;
                bonusesCount = 0;
                pointsLost = 0;
                pointsEarned = 0;

                while (grid.hasChildNodes()) {
                    grid.lastChild.remove();
                }

                /** @type {string[]} */
                let tempArray = cards.concat(cards);

                // Fill the grid with cards
                while (tempArray.length > 0) {
                    let i = Math.floor(Math.random() * tempArray.length);

                    /** @type {HTMLDivElement} */
                    let card = grid.appendChild(
                        document.createElement('button')
                    );

                    card.classList.add('card', 'open');
                    card.dataset.icon = tempArray[i];
                    card.textContent = tempArray[i];

                    setTimeout(() => {
                        card.classList.remove('open');
                        timerStart = Date.now();
                        isGameInProcess = true;
                    }, hideSpeed);

                    // Handle the click event
                    card.addEventListener('click', function (event) {
                        if (this.classList.contains('open')) {
                            return;
                        }

                        if (xRay) {
                            xRay = false;
                            switchXRay();
                        }
                        
                        this.classList.remove('hint-card');
                        this.classList.add('open');
                        timerEnd = Date.now();

                        setTimeout(() => {
                            if (lastOpenCard) {
                                this.blur();

                                if (lastOpenCard.dataset.icon !== this.dataset.icon) {
                                    // Mistake
                                    lastOpenCard.classList.remove('open');
                                    this.classList.remove('open');
                                    mistakesCount ++;

                                    if (!this.classList.contains('special') &&
                                        !lastOpenCard.classList.contains('special'))
                                    {
                                        changeScore(-1);
                                    } else {
                                        processMistake([this, lastOpenCard]);
                                    }
                                } else {
                                    // Correct
                                    if (!this.classList.contains('special') &&
                                        !lastOpenCard.classList.contains('special'))
                                    {
                                        changeScore(2);
                                    } else {
                                        processCorrect([this, lastOpenCard]);
                                    }

                                    this.classList.add('pair-found');
                                    lastOpenCard.classList.add('pair-found');
                                    checkWin();
                                }

                                this.classList.remove('special', ...specialClasses);
                                lastOpenCard.classList.remove('special', ...specialClasses);
                                lastOpenCard = undefined;
                            } else {
                                lastOpenCard = card;
                            }
                        }, 700);
                    });

                    tempArray.splice(i, 1);
                }

                createSpecialCards();
            }

            /**
             * @param {HTMLDivElement} cards
            */
            function processMistake(cards) {
                /** @type {number} */
                let result = 0;
                /** @type {number[]} */
                let mult = [];

                for (let card of cards) {
                    for (let special of specialCards) {
                        if (card.classList.contains(special.name)) {
                            result += special.mistakeAdd;
                            mult.push(special.mistakeMult);
                            break;
                        }
                    }
                }

                mult.forEach(m => result *= m);
                changeScore(result);
            }

            /**
             * @param {HTMLDivElement[]} cards
            */
            function processCorrect(cards) {
                /** @type {number} */
                let result = 0;
                /** @type {number[]} */
                let mult = [];

                for (let card of cards) {
                    for (let special of specialCards) {
                        if (card.classList.contains(special.name)) {
                            result += special.correctAdd;
                            mult.push(special.correctMult);
                            break;
                        }
                    }
                }

                mult.forEach(m => result *= m);
                changeScore(result);
            }

            function checkWin() {
                /** @type {boolean} */
                let allCorrect = true;
                /** @type {HTMLInputElement[]} */
                let cards = grid.getElementsByClassName('card');
                
                for (let c of cards) {
                    if (!c.classList.contains('open')) {
                        allCorrect = false;
                        return;
                    }
                }

                if (allCorrect) {
                    if (win.style.display === 'flex') return;

                    isGameInProcess = false;
                    win.style.display = 'flex';
                    clearInterval(randomXRayInterval);
                    localStorage.setItem('score', score);

                    let date = new Date(timerEnd - timerStart);
                    let min = date.getMinutes();
                    let sec = date.getSeconds();

                    winTime.textContent = `${
                        min > 9 ? min : `0${min}`
                    }:${
                        sec > 9 ? sec : `0${sec}`
                    }`;
                    winMistakes.textContent = mistakesCount;
                    winBonuses.textContent = bonusesCount;
                    winLost.textContent = pointsLost;
                    winEarned.textContent = pointsEarned;

                    win.focus();
                }
            }

            /**
             * @param {number} change
            */
            function changeScore(change) {
                if (change === 0) {
                    return;
                }

                if (change > 0) {
                    pointsEarned += change;
                } else {
                    pointsLost += change * -1;
                }

                score = score + change < 0
                    ? 0
                    : score + change > 100
                        ? 100
                        : score + change;
                
                scoreCount.textContent = score;
            }

            function removeSpecialCards() {
                for (let card of grid.children) {
                    if (card.classList.contains('special')) {
                        card.classList.remove('special', ...specialClasses);
                    }
                }
            }

            function createSpecialCards() {
                for (let card of grid.children) {
                    if (card.classList.contains('pair-found')) {
                        continue;
                    }

                    /** @type {number} */
                    let random = Math.floor(Math.random() * 5);

                    if (random === 0) {
                        /** @type {number} */
                        let index = Math.floor(Math.random() * specialClasses.length);
                        card.classList.add('special', specialClasses[index]);
                    }
                }
            }

            function fillSpecialCardsList() {
                /** @type {HTMLDivElement} */
                let list = document.getElementById('special-list');
                
                for (let special of specialCards) {
                    /** @type {HTMLDivElement} */
                    let item = list.appendChild(
                        document.createElement('div')
                    );
                    item.classList.add('special-help-item');

                    /** @type {HTMLSpanElement} */
                    let symbol = item.appendChild(
                        document.createElement('span')
                    );
                    symbol.classList.add('special-help-symbol');
                    symbol.textContent = special.symbol;

                    /** @type {HTMLParagraphElement} */
                    let description = item.appendChild(
                        document.createElement('p')
                    );
                    description.classList.add('special-help-description');
                    description.textContent = `| ${
                        special.correctDescr} | ${special.mistakeDescr
                    }`;
                }
            }

            function switchXRay() {
                for (let card of grid.children) {
                    if (xRay) {
                        card.classList.add('x-ray');
                    } else {
                        card.classList.remove('x-ray');
                    }
                }
            }

            /**
             * @param {string} bonusId
            */
            function buyBonus(bonusId) {
                if (isGameInProcess === false) {
                    startButton.focus();
                    return;
                }

                for (let bonus of bonuses) {
                    if (bonusId === bonus.name) {
                        if (score >= bonus.cost) {
                            changeScore(bonus.cost * -1);
                            bonusesCount ++;
                            bonus.func();
                        } else {
                            scoreDiv.classList.add('not-enough-score');
                            setTimeout(() => {
                                scoreDiv.classList.remove('not-enough-score');
                            }, 700);
                        }
                        break;
                    }
                }
            }

            /**
             * @param {string} newType
            */
            function replaceSpecialCards(newType) {
                for (let card of grid.children) {
                    if (card.classList.contains('special')) {
                        card.classList.remove(...specialClasses);
                        card.classList.add(newType);
                    }
                }
            }

            fillSpecialCardsList();
            createSpecialCards();

            generateLanguagesList([
                {
                    name: 'English [Vitaly Ulyanov]',
                    langTags: ['en', 'en-AU', 'en-BZ', 'en-CA', 'en-CB', 'en-GB', 'en-IE', 'en-JM', 'en-NZ', 'en-PH', 'en-TT', 'en-US', 'en-ZA', 'en-ZW'],
                    elements: [
                        {
                            "id": "game-name",
                            "childNodesTexts": [
                                "Pairs"
                            ]
                        },
                        {
                            "id": "settings-summary",
                            "childNodesTexts": [
                                "Settings"
                            ]
                        },
                        {
                            "id": "fontLabel",
                            "childNodesTexts": [
                                "Font"
                            ]
                        },
                        {
                            "id": "fontInput",
                            "childNodesTexts": [],
                            "placeholder": "Type a font's name and press Enter"
                        },
                        {
                            "id": "primLabel",
                            "childNodesTexts": [
                                "Background colour"
                            ]
                        },
                        {
                            "id": "secLabel",
                            "childNodesTexts": [
                                "Text colour"
                            ]
                        },
                        {
                            "id": "acc1Label",
                            "childNodesTexts": [
                                "Accent colour 1"
                            ]
                        },
                        {
                            "id": "acc2Label",
                            "childNodesTexts": [
                                "Accent colour 2"
                            ]
                        },
                        {
                            "id": "loadLabel",
                            "childNodesTexts": [
                                "📁 Load colours"
                            ]
                        },
                        {
                            "id": "saveColoursButton",
                            "childNodesTexts": [
                                "💾 Save colours"
                            ]
                        },
                        {
                            "id": "exportLang",
                            "childNodesTexts": [
                                "🌐 Export texts for translation"
                            ]
                        },
                        {
                            "id": "loadPackButton",
                            "childNodesTexts": [
                                "📁 Load",
                                "Load pack from .txt file"
                            ]
                        },
                        {
                            "id": "savePackButton",
                            "childNodesTexts": [
                                "💾 Save",
                                "Save pack to .txt file"
                            ]
                        },
                        {
                            "id": "cards",
                            "childNodesTexts": [],
                            "placeholder": "Cards' symbols (separated by space)"
                        },
                        {
                            "id": "start",
                            "childNodesTexts": [
                                "Start"
                            ]
                        },
                        {
                            "id": "grid-size-tooltip",
                            "childNodesTexts": [
                                "Grid size slider"
                            ]
                        },
                        {
                            "id": "grid-victory",
                            "childNodesTexts": [
                                "Victory!"
                            ]
                        },
                        {
                            "id": "grid-win-stats-label",
                            "childNodesTexts": [
                                "Statistics"
                            ]
                        },
                        {
                            "id": "grid-win-time-label",
                            "childNodesTexts": [
                                "Time (min:sec)"
                            ]
                        },
                        {
                            "id": "grid-win-mistakes-label",
                            "childNodesTexts": [
                                "Mistakes"
                            ]
                        },
                        {
                            "id": "grid-win-loss-label",
                            "childNodesTexts": [
                                "Points lost"
                            ]
                        },
                        {
                            "id": "grid-win-gain-label",
                            "childNodesTexts": [
                                "Points earned"
                            ]
                        },
                        {
                            "id": "grid-win-bonuses-label",
                            "childNodesTexts": [
                                "Bonuses used"
                            ]
                        },
                        {
                            "id": "score-count-label",
                            "childNodesTexts": [
                                "Score:"
                            ]
                        },
                        {
                            "id": "bonuses-shop-summary",
                            "childNodesTexts": [
                                "Bonuses shop"
                            ]
                        },
                        {
                            "id": "bonus-remove-special",
                            "childNodesTexts": [
                                "Nothing extra\n                         [8]",
                                "Remove all special effects from cards."
                            ]
                        },
                        {
                            "id": "bonus-indifference",
                            "childNodesTexts": [
                                "Indifference\n                         [10]",
                                "Turn all special cards into type =."
                            ]
                        },
                        {
                            "id": "bonus-chance",
                            "childNodesTexts": [
                                "Power of chance\n                         [12]",
                                "Remove all special effects from cards and pick new ones randomly."
                            ]
                        },
                        {
                            "id": "bonus-experimenter",
                            "childNodesTexts": [
                                "Experimenter\n                         [14]",
                                "Turn all special cards into type >."
                            ]
                        },
                        {
                            "id": "bonus-random-x-ray",
                            "childNodesTexts": [
                                "Random X-ray\n                         [16]",
                                "From time to time a random ordinary card receives X-ray effect for 3 seconds: reveal it on hovering."
                            ]
                        },
                        {
                            "id": "bonus-x-ray",
                            "childNodesTexts": [
                                "Full X-ray\n                         [20]",
                                "X-ray mode: reveal any card on hovering. Disables after choosing a card."
                            ]
                        },
                        {
                            "id": "bonus-optimist",
                            "childNodesTexts": [
                                "Optimist\n                         [25]",
                                "Turn all special cards into type +."
                            ]
                        },
                        {
                            "id": "bonus-minesweeper",
                            "childNodesTexts": [
                                "Minesweeper\n                         [30]",
                                "Random ordinary cards show horizontal distance to their pairs on hover."
                            ]
                        },
                        {
                            "id": "rules-summary",
                            "childNodesTexts": [
                                "Rules"
                            ]
                        },
                        {
                            "id": "rules-general",
                            "childNodesTexts": [
                                "Find pairs of cards by trying to memorise as many as you can in the beginning of the game and by careful guessing. A right guess gives you a reward (",
                                "2 ",
                                "points), while a wrong one results in a penalty (",
                                "-1 ",
                                "point). Use points to buy ",
                                "bonuses ",
                                "that make the game a bit easier. And pay attention to ",
                                "special cards",
                                ", they have some additional effects (see below)."
                            ]
                        },
                        {
                            "id": "rules-special-cards",
                            "childNodesTexts": [
                                "Special cards"
                            ]
                        },
                        {
                            "id": "special-help-header",
                            "childNodesTexts": [
                                "Card | Reward | Penalty"
                            ]
                        },
                        {
                            "id": "author",
                            "childNodesTexts": [
                                "Made by Vitaly Pavlovich Ulyanov."
                            ]
                        },
                        {
                            "id": "fullscreenButton",
                            "childNodesTexts": [
                                "▲",
                                "Fullscreen"
                            ]
                        }
                    ]
                },
                {
                    name: 'Русский [Виталий Ульянов]',
                    langTags: ['ru', 'ru-RU'],
                    elements: [
                        {
                            "id": "game-name",
                            "childNodesTexts": [
                                "Пары"
                            ]
                        },
                        {
                            "id": "settings-summary",
                            "childNodesTexts": [
                                "Настройки"
                            ]
                        },
                        {
                            "id": "fontLabel",
                            "childNodesTexts": [
                                "Шрифт"
                            ]
                        },
                        {
                            "id": "fontInput",
                            "childNodesTexts": [],
                            "placeholder": "Введите название шрифта и нажмите Enter"
                        },
                        {
                            "id": "primLabel",
                            "childNodesTexts": [
                                "Цвет фона"
                            ]
                        },
                        {
                            "id": "secLabel",
                            "childNodesTexts": [
                                "Цвет текста"
                            ]
                        },
                        {
                            "id": "acc1Label",
                            "childNodesTexts": [
                                "Акцентный цвет 1"
                            ]
                        },
                        {
                            "id": "acc2Label",
                            "childNodesTexts": [
                                "Акцентный цвет 2"
                            ]
                        },
                        {
                            "id": "loadLabel",
                            "childNodesTexts": [
                                "📁 Загрузить цвета"
                            ]
                        },
                        {
                            "id": "saveColoursButton",
                            "childNodesTexts": [
                                "💾 Сохранить цвета"
                            ]
                        },
                        {
                            "id": "exportLang",
                            "childNodesTexts": [
                                "🌐 Экспортировать тексты для перевода"
                            ]
                        },
                        {
                            "id": "loadPackButton",
                            "childNodesTexts": [
                                "📁 Загрузить",
                                "Загрузить колоду из файла .txt"
                            ]
                        },
                        {
                            "id": "savePackButton",
                            "childNodesTexts": [
                                "💾 Сохранить",
                                "Сохранить колоду в файл .txt"
                            ]
                        },
                        {
                            "id": "cards",
                            "childNodesTexts": [],
                            "placeholder": "Символы карт (разделённые пробелом)"
                        },
                        {
                            "id": "start",
                            "childNodesTexts": [
                                "Начать"
                            ]
                        },
                        {
                            "id": "grid-size-tooltip",
                            "childNodesTexts": [
                                "Ползунок ширины сетки"
                            ]
                        },
                        {
                            "id": "grid-victory",
                            "childNodesTexts": [
                                "Победа!"
                            ]
                        },
                        {
                            "id": "grid-win-stats-label",
                            "childNodesTexts": [
                                "Статистика"
                            ]
                        },
                        {
                            "id": "grid-win-time-label",
                            "childNodesTexts": [
                                "Время (мин:сек)"
                            ]
                        },
                        {
                            "id": "grid-win-mistakes-label",
                            "childNodesTexts": [
                                "Ошибок"
                            ]
                        },
                        {
                            "id": "grid-win-loss-label",
                            "childNodesTexts": [
                                "Баллов потеряно"
                            ]
                        },
                        {
                            "id": "grid-win-gain-label",
                            "childNodesTexts": [
                                "Баллов заработано"
                            ]
                        },
                        {
                            "id": "grid-win-bonuses-label",
                            "childNodesTexts": [
                                "Бонусов использовано"
                            ]
                        },
                        {
                            "id": "score-count-label",
                            "childNodesTexts": [
                                "Счёт:"
                            ]
                        },
                        {
                            "id": "bonuses-shop-summary",
                            "childNodesTexts": [
                                "Магазин бонусов"
                            ]
                        },
                        {
                            "id": "bonus-remove-special",
                            "childNodesTexts": [
                                "Ничего лишнего\n                         [8]",
                                "Убрать все особые эффекты карт."
                            ]
                        },
                        {
                            "id": "bonus-indifference",
                            "childNodesTexts": [
                                "Безразличие\n                         [10]",
                                "Преобразовать все особые карты в тип =."
                            ]
                        },
                        {
                            "id": "bonus-chance",
                            "childNodesTexts": [
                                "Воля случая\n                         [12]",
                                "Убрать все особые эффекты карт и случайным образом выбрать новые."
                            ]
                        },
                        {
                            "id": "bonus-experimenter",
                            "childNodesTexts": [
                                "Экспериментатор\n                         [14]",
                                "Преобразовать все особые карты в тип >."
                            ]
                        },
                        {
                            "id": "bonus-random-x-ray",
                            "childNodesTexts": [
                                "Случайный рентген\n                         [16]",
                                "Время от времени у случайной обычной карты на 3 секунды включается рентген: наведите на неё, чтобы увидеть её символ."
                            ]
                        },
                        {
                            "id": "bonus-x-ray",
                            "childNodesTexts": [
                                "Полный рентген\n                         [20]",
                                "Режим рентгена: наведите на любую карту, чтобы увидеть её символ. Отключается после выбора карты."
                            ]
                        },
                        {
                            "id": "bonus-optimist",
                            "childNodesTexts": [
                                "Оптимист\n                         [25]",
                                "Преобразовать все особые карты в тип +."
                            ]
                        },
                        {
                            "id": "bonus-minesweeper",
                            "childNodesTexts": [
                                "Сапёр\n                         [30]",
                                "У случайных обычных карт при наведении показывается горизонтальное расстояние до их пары."
                            ]
                        },
                        {
                            "id": "rules-summary",
                            "childNodesTexts": [
                                "Правила"
                            ]
                        },
                        {
                            "id": "rules-general",
                            "childNodesTexts": [
                                "Находите пары карт, пытаясь как можно больше запоминать в начале игры и в процессе неё. За верную догадку Вы получаете награду (",
                                "2 ",
                                "очка), а за неверную — штраф (",
                                "-1 ",
                                "очко). Используйте очки для покупки ",
                                "бонусов",
                                ", немного упрощающих игру. Также обращайте внимание на ",
                                "особые карты",
                                ", у них есть дополнительные эффекты (см. ниже)."
                            ]
                        },
                        {
                            "id": "rules-special-cards",
                            "childNodesTexts": [
                                "Особые карты"
                            ]
                        },
                        {
                            "id": "special-help-header",
                            "childNodesTexts": [
                                "Карта | Награда | Штраф"
                            ]
                        },
                        {
                            "id": "author",
                            "childNodesTexts": [
                                "Автор — Виталий Павлович Ульянов."
                            ]
                        },
                        {
                            "id": "fullscreenButton",
                            "childNodesTexts": [
                                "▲",
                                "Полный экран"
                            ]
                        }
                    ]
                }
            ]);
        </script>
    </body>
</html>
