<!DOCTYPE html>
<html lang='en'>
    <head>
        <meta charset='utf-8' />
        <meta http-equiv='X-UA-Compatible' content='IE=edge' />
        <title>Marker</title>
        <meta name='viewport' content='width=device-width, initial-scale=1' />
        

        <style>
            :root {
                --accent1: #774936;
                --accent2: #D69F7E;
                --primary-colour: #eeebbd;
                --secondary-colour: #050609;
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            }
            
            * {
                background-color: inherit;
                box-sizing: border-box;
                color: inherit;
                font-family: inherit;
                font-size: 14pt;
                margin-top: 1.5px;
                margin-bottom: 1.5px;
            }
            
            body {
                display: flex;
                flex-direction: column;
                accent-color: var(--accent1);
                background-color: var(--primary-colour);
                color: var(--secondary-colour);
                margin: auto;
                min-width: 85%;
                max-width: 85%;
            }
            
            b {
                background-color: transparent;
            }
            
            .menuButton {
                cursor: pointer;
                display: flex;
                flex-grow: 1;
                align-items: center;
                justify-content: center;
                background-color: var(--accent2);
                color: var(--secondary-colour);
                box-shadow: inset 0px 0px 6px var(--accent1);
                border: 2px outset var(--accent1);
                font-weight: 600;
                text-align: center;
                text-decoration: none;
                text-wrap: nowrap;
                overflow: auto;
                padding: 2px;
            }
            
            .menuButton:hover,
            .menuButton:focus {
                background-color: var(--secondary-colour);
                color: var(--primary-colour);
            }
            
            a.button,
            button {
                display: inline-flex;
                background-color: var(--accent2);
                color: var(--secondary-colour);
                box-shadow: inset 0px 0px 6px var(--accent1);
                border: 2px outset var(--accent1);
                border-radius: 4px;
                cursor: pointer;
                padding-inline: 6px;
                align-items: center;
                justify-content: center;
            }
            
            button:disabled {
                background-color: var(--primary-colour);
                color: var(--secondary-colour);
                cursor: not-allowed;
            }
            
            button:focus,
            button:hover {
                background-color: var(--secondary-colour);
                color: var(--primary-colour);
            }
            
            details {
                display: flex;
                flex-direction: column;
                cursor: default;
                width: 100%;
            }
            
            details > summary {
                background-color: var(--primary-colour);
                box-shadow: inset -1px 1px 4px var(--secondary-colour);
                border-top: 2px inset var(--secondary-colour);
                border-radius: 4px;
                cursor: pointer;
                padding: 2px 6px;
            }
            
            details > summary:focus,
            details > summary:hover,
            details[open] > summary:focus,
            details[open] > summary:hover {
                background-color: var(--secondary-colour);
                color: var(--accent2);
            }
            
            details[open] > summary {
                background-color: var(--accent2);
                border-radius: 0px 0px 8px 4px;
                font-size: 1.05em;
                padding-bottom: 2px;
                position: sticky;
                top: 0px;
                z-index: 1;
            }
            
            h1 {
                align-self: center;
                border-bottom: 4px dotted var(--accent1);
                margin: 4px 0px 4px 0px;
                padding: 8px 12px 4px 12px;
                font-size: 1.7em;
            }
            
            h2 {
                box-shadow: 0px 0px 3px var(--secondary-colour);
                border-left: 6px solid var(--secondary-colour);
                border-radius: 4px;
                margin: 4px 0px 4px 0px;
                padding-left: 4px;
                font-size: 1.5em;
            }
            
            h3 {
                box-shadow: 0px 0px 4px var(--accent1);
                border-left: 6px solid var(--accent1);
                border-radius: 4px;
                margin: 4px 0px 4px 6px;
                padding-left: 4px;
                font-size: 1.3em;
            }
            
            hr {
                border: 2px ridge var(--accent1);
                border-radius: 4px;
                width: 100%;
            }
            
            input {
                border: 2px outset var(--secondary-colour);
                accent-color: var(--accent2);
            }
            
            input::placeholder {
                color: var(--accent1);
            }
            
            input[type='file'] {
                border-style: none;
            }
            
            input[type='number'] {
                border-color: var(--accent1);
                border-radius: 4px;
                text-align: center;
                font-weight: 600;
            }
            
            input[type='number']:focus {
                color: var(--secondary-colour);
                background-color: var(--accent2);
            }
            
            kbd {
                background-color: var(--primary-colour);
                color: var(--secondary-colour);
                border: 1px solid var(--accent1);
                border-radius: 3px;
                border-bottom-width: 2px;
                font-weight: 600;
                padding: 1px 2px;
            }
            
            option:checked {
                background-color: var(--accent2);
            }
            
            select {
                background-color: var(--primary-colour);
                border: 2px inset var(--accent1);
                border-radius: 4px;
                color: var(--secondary-colour);
                overflow: auto;
            }
            
            table {
                width: 100%;
                border-collapse: collapse;
            }
            
            td,
            th {
                border: 2px solid var(--secondary-colour);
                padding-inline: 4px;
                text-align: center;
                font-weight: 600;
            }
            
            th {
                background-image: linear-gradient(45deg, var(--accent2), transparent 20% 80%, var(--accent2));
                background-color: var(--primary-colour);
                border-color: var(--accent1);
                color: var(--accent1);
                font-size: 1.05em;
                position: sticky;
                top: 0px;
                z-index: 1;
            }
            
            th:focus,
            th:hover,
            tr:focus,
            tr:hover,
            tbody > tr:nth-of-type(even):focus,
            tbody > tr:nth-of-type(even):hover {
                border-color: var(--accent1);
                background-color: var(--secondary-colour);
                color: var(--primary-colour);
            }
            
            tbody > tr:nth-of-type(even) {
                background-color: var(--accent1);
                color: var(--primary-colour);
            }
            
            textarea {
                border: 2px outset var(--secondary-colour);
                border-radius: 4px;
            }
            
            textarea::placeholder {
                color: var(--accent1);
            }
            
            .box {
                display: flex;
                flex-direction: row;
                border: 2px outset var(--accent1);
                border-radius: 4px;
                padding: 2px;
            }
            
            .box:focus,
            .box:hover {
                background-color: var(--accent1);
                color: var(--primary-colour);
            }
            
            @keyframes tooltipFadeIn {
                from {
                    opacity: 0;
                }
                to {
                    opacity: 0.95;
                }
            }
            
            .modalButtonContainer {
                display: flex;
                flex-direction: row;
                justify-content: space-evenly;
            }
            
            .modalButton {
                border-radius: 4px;
            }
            
            .modalText {
                overflow: auto;
            }
            
            .modalWindow {
                display: none;
                flex-direction: column;
                align-self: center;
                text-align: center;
                box-shadow: 0px 0px 10px 2px var(--secondary-colour);
                border: 4px inset var(--accent1);
                border-radius: 4px;
                padding: 4px;
                max-height: 50vh;
                position: fixed;
                z-index: 9;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
            }
            
            .tooltipParent {
                position: relative;
            }
            
            .tooltipParent:focus > .tooltip,
            .tooltipParent:hover > .tooltip {
                display: flex;
                animation: tooltipFadeIn 0.7s ease;
            }
            
            .tooltip {
                display: none;
                background-color: var(--secondary-colour);
                color: var(--primary-colour);
                opacity: 0.95;
                border: 2px outset var(--accent1);
                border-radius: 4px;
                padding: 3px;
                position: fixed;
                top: 5px;
                left: 5px;
                z-index: 10;
                min-width: min-content;
                width: max-content;
                max-width: 75vw;
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                font-weight: 600;
                text-align: left;
                text-wrap: wrap;
            }
            
            .tooltip::before {
                content: 'i';
                background-color: var(--primary-colour);
                color: var(--secondary-colour);
                border-radius: 4px;
                margin-right: 4px;
                height: 100%;
                padding-inline: 0.5em;
                font-style: italic;
                font-weight: 600;
            }
            
            #author {
                display: block;
            }

            /* Elements */
            #menu,
            #source {
                margin: 0;
            }

            #menu[open] > #menu-summary,
            #source[open] > #source-summary {
                background-color: var(--accent2);
                color: var(--secondary-colour);
            }

            #menu-summary,
            #source-summary {
                background-color: transparent;
                color: var(--secondary-colour);
                border: 2px outset var(--secondary-colour);
                border-bottom-style: none;
                border-radius: 0px;
                margin: 0;
            }

            #menu-summary:focus,
            #menu-summary:hover,
            #source-summary:focus,
            #source-summary:hover {
                background-color: var(--secondary-colour);
                color: var(--accent2);
            }

            #menu[open] > #menu-summary:focus,
            #menu[open] > #menu-summary:hover,
            #source[open] > #source-summary:focus,
            #source[open] > #source-summary:hover {
                background-color: var(--secondary-colour);
                color: var(--accent2);
            }

            #add-mistake-0,
            #add-mistake-1,
            #add-mistake-2,
            #add-mistake-3 {
                display: flex;
                margin: 0;
            }

            #add-mistake-1,
            #add-mistake-2,
            #add-mistake-3 {
                display: none;
                flex-wrap: wrap;
            }

            #clear-mistake-button {
                border-radius: 0px;
                font-family: 'Courier New', Courier, monospace;
                font-size: 1.2em;
                font-weight: 900;
                margin: 0;
            }

            #mistakeContent {
                background-color: var(--accent2);
                border-right-style: none;
                border-left-style: none;
                border-radius: 0px;
                text-align: center;
                margin: 0;
                width: 100%;
            }

            #source-text,
            #work {
                display: block;
                border-bottom-style: none;
                border-top-style: none;
                resize: vertical;
                margin: 0;
                padding-inline: 2vw;
                min-height: 28vh;
                width: 100%;
            }

            #stud-div {
                display: flex;
                margin: 0;
            }

            #prev-stud,
            #next-stud {
                font-size: 1.1em;
                font-weight: 900;
                margin: 0;
            }

            #prev-stud {
                border-radius: 0px 0px 0px 7px;
            }

            #next-stud {
                border-radius: 0px 0px 7px 0px;
            }

            #student {
                background-color: var(--accent2);
                border-left-style: none;
                border-right-style: none;
                text-align: center;
                font-weight: 600;
                margin: 0;
                width: 100%;
            }

            #student-count {
                align-content: center;
                background-color: var(--accent2);
                border-top: 2px outset var(--secondary-colour);
                border-bottom: 2px outset var(--secondary-colour);
                font-weight: 600;
                margin: 0;
                padding-inline: 4px;
                width: fit-content;
            }

            #results-table {
                margin-bottom: 0;
            }

            #res-mark {
                background-color: var(--accent2);
            }

            #res-mark:focus,
            #res-mark:hover {
                background-color: var(--secondary-colour);
            }

            #copy-mark-button {
                border-radius: 0px 0px 0px 7px;
                border-top-style: none;
                margin-top: 0;
            }

            /* CSS classes */
            .menu-div {
                display: flex;
                flex-wrap: wrap;
                margin: 0;
            }

            .menu-button {
                background-color: transparent;
                flex-grow: 1;
                border-radius: 0px;
                font-weight: 600;
                margin: 0;
                padding: 2px;
                min-width: fit-content;
                max-width: 100%;
            }

            .add-mistake-button {
                border-radius: 0px;
                margin: 0;
                width: fit-content;
                min-width: 25%;
            }

            .mistake-category-button {
                flex-grow: 1;
                border-radius: 0px;
                font-style: italic;
                margin: 0;
                padding-inline: 0;
                padding-block: 4px;
                min-width: fit-content;
                max-width: 100%;
            }

            .cancel-div {
                display: flex;
                width: 100%;
                margin: 0;
            }

            .cancel-button {
                background-color: var(--accent1);
                color: var(--primary-colour);
                font-weight: 600;
                border-radius: 0px;
                margin-bottom: 0;
                margin-top: 4px;
                width: 100%;
            }

            .student-button {
                border-color: var(--secondary-colour);
                border-radius: 0;
                font-family: 'Courier New', Courier, monospace;
                font-size: 1.1em;
                font-weight: 900;
                margin: 0;
                width: 1.85em;
            }

            .mistake-container {
                align-items: center;
                display: flex;
                column-gap: 4px;
            }

            .remove {
                font-family: 'Courier New', Courier, monospace;
                font-size: 1.2em;
                font-weight: 900;
                border-radius: 50%;
                height: 1em;
                width: 1em;
            }

            .mistake {
                background-color: transparent;
                border-radius: 0px;
                text-align: left;
            }
        </style>
    </head>
    <body>
        <h1 id='page-title'>Marker</h1>

        <!-- Settings -->
        <details id='settings'>
            <summary id='settings-summary'>Settings</summary>
        </details>

        <!-- Page main body -->
        
        <!-- Menu -->
        <details id='menu' open>
            <summary id='menu-summary'>Menu</summary>

            <div class='menu-div'>
                <!-- Save works -->
                <a
                    id='saveWorksButton'
                    href=''
                    class='menuButton menu-button tooltipParent'
                    onclick='saveWorksFile()'
                >
                    Save
                    <span class='tooltip'>Save works to .json file</span>
                </a>

                <!-- Load works -->
                <button
                    id='loadWorksButton'
                    class='menu-button tooltipParent'
                    onclick='document.getElementById("loadWorks").click()'
                >
                    Load
                    <span class='tooltip'>Load works from .json file</span>
                </button>
                <input
                    id='loadWorks'
                    type='file'
                    accept='.json'
                    onchange='loadWorksFile()'
                    style='display: none;'
                >
                </input>

                <!-- Sort students alphabetically -->
                <button id='sort-button' class='menu-button tooltipParent' onclick='sortStudents()'>
                    Sort
                    <span class='tooltip'>Sort students alphabetically</span>
                </button>

                <!-- Save results -->
                <a
                    id='saveResultsButton'
                    href=''
                    class='menuButton menu-button tooltipParent'
                    onclick='saveResultsFile()'
                >
                    Save results
                    <span class='tooltip'>Save results to .txt file</span>
                </a>
            </div>
        </details>

        <!-- Source text -->
        <details id='source' open>
            <summary id='source-summary'>Source text</summary>
            <textarea id='source-text' placeholder='Text to translate' autocomplete='off'></textarea>
        </details>

        <!-- Add mistake -->
        <div id='add-mistake-0'>
            <button id='clear-mistake-button' class='tooltipParent'>
                -
                <span class='tooltip'>Clear mistake's description</span>
            </button>
            <input type='text' id='mistakeContent' placeholder='Mistake' autocomplete='off'>
            <button id='next' class='add-mistake-button' onclick='hideDiv(0, 1)'>Next</button>
        </div>

        <div id='add-mistake-1'>
            <button id='type-gr' class='mistake-category-button' onclick='addType(TYPE_GRAMMAR)'>Grammar</button>
            <button id='type-voc' class='mistake-category-button' onclick='addType(TYPE_VOCABULARY)'>Vocabulary</button>
            <button id='type-orth' class='mistake-category-button' onclick='addType(TYPE_ORTHOGRAPHY)'>Orthography</button>
            <button id='type-punc' class='mistake-category-button' onclick='addType(TYPE_PUNCTUATION)'>Punctuation</button>
            <button id='type-comp' class='mistake-category-button' onclick='addType(TYPE_COMPLEX)'>Complex</button>
            <button id='back-1' class='cancel-button' onclick='hideDiv(1, 0)'>Back</button>
        </div>

        <div id='add-mistake-2'>
            <button id='subtype-add' class='mistake-category-button' onclick='addSubtype(SUBTYPE_ADDITION)'>Redundant element</button>
            <button id='subtype-dis' class='mistake-category-button' onclick='addSubtype(SUBTYPE_DISTORTION)'>Incorrect element</button>
            <button id='subtype-del' class='mistake-category-button' onclick='addSubtype(SUBTYPE_DELETION)'>Lack of element</button>
            
            <div class='cancel-div'>
                <button id='back-2' class='cancel-button' onclick='hideDiv(2, 1)'>Back</button>
                <button id='cancel-2' class='cancel-button' onclick='hideDiv(2, 0)'>Cancel</button>
            </div>
        </div>

        <div id='add-mistake-3'>
            <button id='meaning-ret' class='mistake-category-button' onclick='addMeaning(MEANING_RETAINED)'>Meaning retained</button>
            <button id='meaning-obsc' class='mistake-category-button' onclick='addMeaning(MEANING_OBSCURED)'>Meaning obscured</button>
            <button id='meaning-lost' class='mistake-category-button' onclick='addMeaning(MEANING_LOST)'>Meaning lost</button>
            
            <div class='cancel-div'>
                <button id='back-3' class='cancel-button' onclick='hideDiv(3, 2)'>Back</button>
                <button id='cancel-3' class='cancel-button' onclick='hideDiv(3, 0)'>Cancel</button>
            </div>
        </div>

        <!-- Translation -->
        <textarea id='work' placeholder="Student's translation" autocomplete='off'></textarea>

        <!-- Students -->
        <div id='stud-div'>
            <button id='prev-stud' class='tooltipParent'>
                &lt;
                <span class='tooltip'>Previous student</span>
            </button>

            <input type='text' id='student' placeholder='Student' autocomplete='off'>

            <!-- Add & remove student -->
            <button id='student-add-button' class='student-button tooltipParent'>
                +
                <span class='tooltip'>Add student</span>
            </button>

            <button id='student-remove-button' class='student-button tooltipParent'>
                -
                <span class='tooltip'>Remove student</span>
            </button>

            <span id='student-count' tabindex='0'>[1/1]</span>

            <button id='next-stud' class='tooltipParent'>
                &gt;
                <span class='tooltip'>Next student</span>
            </button>
        </div>

        <!-- Mistakes -->
        <h3 id='mistakesHeader'>Mistakes:</h3>
        <div id='mistakes'></div>
        <span id='remove-mistake-tooltip' style='display: none;' hidden>Remove mistake</span>

        <!-- Results -->
        <table id='results-table'>
            <th id='results-header' colspan='2' tabindex='0'>
                Results
            </th>

            <tr>
                <td id='res-mistakes-label' tabindex='0'>Mistakes count</td>
                <td id='res-mistakes' tabindex='0'>0</td>
            </tr>

            <tr>
                <td id='res-weight-label' tabindex='0'>Mistakes weight</td>
                <td id='res-weight' tabindex='0'>0</td>
            </tr>

            <tr>
                <td id='res-mark-label' tabindex='0'>Mark</td>
                <td id='res-mark' tabindex='0'>100 (A)</td>
            </tr>
        </table>

        <button id='copy-mark-button'>Copy mark</button>

        <!-- Mistakes classification -->
        <details>
            <summary id='help-summary'>Classification of mistakes</summary>

            <ol>
                <li id='help-type'><b>Type</b>:</li>
                <ul>
                    <li id='help-gr'><b>Grammar</b>: a mistake while conveying the meaning of a grammatical form (a wrong tense, article, declension, etc.).</li>
                    <li id='help-voc'><b>Vocabulary</b>: a mistake while conveying the meaning of a word (a wrong word, collocation, style, etc.).</li>
                    <li id='help-ort'><b>Orthography</b>: a wrong spelling of a word.</li>
                    <li id='help-pun'><b>Punctuation</b>: an incorrect usage of punctuation marks.</li>
                    <li id='help-com'><b>Complex</b>: a serious mistake or a combination of mistakes in a text unit larger than a character or a word (e.g., a phrase or a sentence).</li>
                </ul>

                <li id='help-subtype'><b>Subtype</b>:</li>
                <ul>
                    <li id='help-red'><b>Redundant element</b>: a wrong extra element is inserted.</li>
                    <li id='help-inc'><b>Incorrect element</b>: a correct element is replaced with a wrong one.</li>
                    <li id='help-lack'><b>Lack of element</b>: a correct element is absent.</li>
                </ul>

                <li id='help-meaning'><b>Text's meaning</b>:</li>
                <ul>
                    <li id='help-ret'><b>Retained</b>: the mistake does not make understanding the text harder.</li>
                    <li id='help-obsc'><b>Obscured</b>: the text's meaning can be understood only with the help of the immediate context*.</li>
                    <li id='help-lost'><b>Lost</b>: the text's meaning is severely distorted and cannot be understood even with the help of the immediate context*.</li>
                </ul>
            </ol>

            <span id='help-context'>*<b>Immediate context</b> = <i>everything before</i> the analysed sentence + <i>this sentence</i> + <i>one sentence after</i> it.</span>
        </details>

        <!-- Author -->
        <p id='author' class='box' style='font-style: italic'>
            Made by Vitaly Pavlovich Ulyanov.
        </p>
        <!-- Автор — Виталий Павлович Ульянов. -->

        <script>
            /**
             * JavaScript logic for HTML programmes by Vital (Vitaly Pavlovich Ulyanov)
             */
            
            // Stored values and style variables
            let storedPrimaryColour =
                localStorage.getItem('--primary-colour') ??
                getComputedStyle(document.body).getPropertyValue('--primary-colour');
            let storedSecondaryColour =
                localStorage.getItem('--secondary-colour') ??
                getComputedStyle(document.body).getPropertyValue('--secondary-colour');
            let storedAccentColour1 =
                localStorage.getItem('--accent1') ??
                getComputedStyle(document.body).getPropertyValue('--accent1');
            let storedAccentColour2 =
                localStorage.getItem('--accent2') ??
                getComputedStyle(document.body).getPropertyValue('--accent2');
            
            document.body.style.setProperty('--primary-colour', storedPrimaryColour);
            document.body.style.setProperty('--secondary-colour', storedSecondaryColour);
            document.body.style.setProperty('--accent1', storedAccentColour1);
            document.body.style.setProperty('--accent2', storedAccentColour2);
            
            /** @type {HTMLDetailsElement} */
            let settings = document.getElementById('settings');
            
            // Append settings with unified ones
            let fullscreen = settings.parentElement.appendChild(
                document.createElement('button')
            );
            let font = settings.appendChild(document.createElement('div'));
            let setDiv = settings.appendChild(document.createElement('div'));
            let primDiv = setDiv.appendChild(document.createElement('div'));
            let secDiv = setDiv.appendChild(document.createElement('div'));
            let acc1Div = setDiv.appendChild(document.createElement('div'));
            let acc2Div = setDiv.appendChild(document.createElement('div'));
            let load = settings.appendChild(document.createElement('div'));
            let save = settings.appendChild(document.createElement('a'));
            
            setDiv.style.display = 'flex';
            setDiv.style.flexWrap = 'wrap';
            
            //#region Fullscreen button
            const up = '&#9650;';
            const down = '&#9660;';
            
            fullscreen.id = 'fullscreenButton';
            fullscreen.classList = 'tooltipParent';
            fullscreen.innerHTML = up;
            fullscreen.style.fontWeight = 600;
            fullscreen.style.borderWidth = 0;
            fullscreen.style.opacity = '0.9';
            fullscreen.style.position = 'fixed';
            fullscreen.style.paddingInline = '2px';
            fullscreen.style.top = '5px';
            fullscreen.style.right = '5px';
            fullscreen.addEventListener('click', function () {
                let page = document.documentElement;
                if (document.fullscreenElement) {
                    if (document.exitFullscreen) document.exitFullscreen();
                } else {
                    if (page.requestFullscreen) page.requestFullscreen();
                }
            });
            
            let fullscreenTooltip = document.createElement('span');
            fullscreenTooltip.className = 'tooltip';
            fullscreenTooltip.textContent = 'Fullscreen';
            
            fullscreen.appendChild(fullscreenTooltip);
            
            document.addEventListener('fullscreenchange', function () {
                if (document.fullscreenElement) fullscreen.innerHTML = down;
                else fullscreen.innerHTML = up;
                fullscreen.appendChild(fullscreenTooltip);
            });
            //#endregion
            
            //#region Font
            let fontDiv = font.appendChild(document.createElement('div'));
            fontDiv.style.display = 'flex';
            fontDiv.style.alignItems = 'baseline';
            fontDiv.style.columnGap = '4px';
            
            let fontLabel = fontDiv.appendChild(document.createElement('label'));
            let fontInput = fontDiv.appendChild(document.createElement('input'));
            
            fontLabel.id = 'fontLabel';
            fontLabel.htmlFor = 'fontInput';
            fontLabel.textContent = 'Font';
            
            fontInput.id = 'fontInput';
            fontInput.type = 'text';
            fontInput.placeholder = 'Type a font\'s name and press Enter';
            fontInput.style.width = '100%';
            fontInput.addEventListener('change', function () {
                localStorage.setItem('pageFont', this.value);
                loadFont();
            });
            //#endregion
            
            //#region Primary colour
            primDiv.style.display = 'flex';
            primDiv.style.minWidth = '50%';
            primDiv.style.alignItems = 'center';
            primDiv.style.columnGap = '4px';
            
            let primInput = primDiv.appendChild(document.createElement('input'));
            primInput.id = 'primCol';
            primInput.type = 'color';
            primInput.value = storedPrimaryColour;
            primInput.addEventListener('input', function () {
                colourChange('primary', this.value);
            });
            
            let primLabel = primDiv.appendChild(document.createElement('label'));
            primLabel.id = 'primLabel';
            primLabel.htmlFor = primInput.id;
            primLabel.textContent = 'Background colour';
            primLabel.style.verticalAlign = 'center';
            //#endregion
            
            //#region Secondary colour
            secDiv.style.display = 'flex';
            secDiv.style.alignItems = 'center';
            secDiv.style.columnGap = '4px';
            
            let secInput = secDiv.appendChild(document.createElement('input'));
            secInput.id = 'secCol';
            secInput.type = 'color';
            secInput.value = storedSecondaryColour;
            secInput.addEventListener('input', function () {
                colourChange('secondary', this.value);
            });
            
            let secLabel = secDiv.appendChild(document.createElement('label'));
            secLabel.id = 'secLabel';
            secLabel.htmlFor = secInput.id;
            secLabel.textContent = 'Text colour';
            secLabel.style.verticalAlign = 'center';
            //#endregion
            
            //#region Accent colour 1
            acc1Div.style.display = 'flex';
            acc1Div.style.minWidth = '50%';
            acc1Div.style.alignItems = 'center';
            acc1Div.style.columnGap = '4px';
            
            let acc1Input = acc1Div.appendChild(document.createElement('input'));
            acc1Input.id = 'acc1Col';
            acc1Input.type = 'color';
            acc1Input.value = storedAccentColour1;
            acc1Input.addEventListener('input', function () {
                colourChange('accent1', this.value);
            });
            
            let acc1Label = acc1Div.appendChild(document.createElement('label'));
            acc1Label.id = 'acc1Label';
            acc1Label.htmlFor = acc1Input.id;
            acc1Label.textContent = 'Accent colour 1';
            acc1Label.style.verticalAlign = 'center';
            //#endregion
            
            //#region Accent colour 2
            acc2Div.style.display = 'flex';
            acc2Div.style.alignItems = 'center';
            acc2Div.style.columnGap = '4px';
            
            let acc2Input = acc2Div.appendChild(document.createElement('input'));
            acc2Input.id = 'acc2Col';
            acc2Input.type = 'color';
            acc2Input.value = storedAccentColour2;
            acc2Input.addEventListener('input', function () {
                colourChange('accent2', this.value);
            });
            
            let acc2Label = acc2Div.appendChild(document.createElement('label'));
            acc2Label.id = 'acc2Label';
            acc2Label.htmlFor = acc2Input.id;
            acc2Label.textContent = 'Accent colour 2';
            acc2Label.style.verticalAlign = 'center';
            //#endregion
            
            //#region Load button
            load.className = 'box';
            load.style.display = 'flex';
            load.style.flexWrap = 'wrap';
            load.style.alignItems = 'center';
            load.style.justifyContent = 'space-between';
            
            let loadLabel = load.appendChild(document.createElement('label'));
            loadLabel.id = 'loadLabel';
            loadLabel.htmlFor = 'loadColoursButton';
            loadLabel.innerHTML = '&#128193; Load colours';
            loadLabel.style.flexGrow = 1;
            loadLabel.style.cursor = 'pointer';
            
            let loadInput = load.appendChild(document.createElement('input'));
            loadInput.id = 'loadColoursButton';
            loadInput.type = 'file';
            loadInput.accept = '.json';
            loadInput.style.display = 'none';
            loadInput.addEventListener('change', loadColours);
            //#endregion
            
            //#region Save button
            save.id = 'saveColoursButton';
            save.href = '';
            save.download = 'ColourScheme.json';
            save.className = 'box';
            save.innerHTML = '&#128190; Save colours';
            save.style.textDecoration = 'none';
            save.addEventListener('click', saveColours);
            //#endregion
            
            //#region Export texts for translation
            let exportLang = settings.appendChild(document.createElement('a'));
            
            exportLang.id = 'exportLang';
            exportLang.href = '';
            exportLang.download = 'TranslationTemplate.json';
            exportLang.className = 'box';
            exportLang.innerHTML = '&#127760; Export texts for translation';
            exportLang.style.textDecoration = 'none';
            exportLang.addEventListener('click', exportTranslationTemplate);
            //#endregion
            
            function colourChange(colourType, colour) {
                switch (colourType) {
                    case 'primary':
                        document.body.style.setProperty('--primary-colour', colour);
                        localStorage.setItem('--primary-colour', colour);
                        break;
                    case 'secondary':
                        document.body.style.setProperty('--secondary-colour', colour);
                        localStorage.setItem('--secondary-colour', colour);
                        break;
                    case 'accent1':
                        document.body.style.setProperty('--accent1', colour);
                        localStorage.setItem('--accent1', colour);
                        break;
                    case 'accent2':
                        document.body.style.setProperty('--accent2', colour);
                        localStorage.setItem('--accent2', colour);
                        break;
                    default:
                        break;
                }
            }
            
            /**
             * @typedef {Object} ColourScheme
             * @property {string} primary
             * @property {string} secondary
             * @property {string} accent1
             * @property {string} accent2
             */
            
            function saveColours() {
                /** @type {ColourScheme}  */
                let colours = {
                    primary: document.body.style.getPropertyValue('--primary-colour'),
                    secondary: document.body.style.getPropertyValue('--secondary-colour'),
                    accent1: document.body.style.getPropertyValue('--accent1'),
                    accent2: document.body.style.getPropertyValue('--accent2'),
                };
                let data = encodeURIComponent(JSON.stringify(colours, undefined, 2));
                saveColoursButton.href = `data:text/plain;charset=utf-8,${data}`;
            }
            
            /**
             * @typedef {Object} LangElement
             * @property {string} id
             * @property {string} textContent
             * @property {string} placeholder
             * @property {string[]} childNodesTexts
             */
            function exportTranslationTemplate() {
                /** @type {LangElement[]} */
                let elements = [];
            
                document.querySelectorAll('body *').forEach((e) => {
                    if (e.tagName !== 'DIV'
                        && e.tagName !== 'DETAILS'
                        && e.tagName !== 'TABLE'
                        && e.id
                        && e.id !== 'lang'
                    ) {
                        /** @type {LangElement} */
                        let newEl = {};
            
                        newEl.id = e.id;
            
                        if (e.childNodes) {
                            newEl.childNodesTexts = [];
            
                            for (let n of e.childNodes) {
                                if (n.textContent && n.textContent.trim() !== '') {
                                    newEl.childNodesTexts.push(n.textContent.trim());
                                }
                            }
                        } else {
                            if (e.textContent) {
                                newEl.textContent = e.textContent;
                            }
                        }
            
                        if (e.placeholder) {
                            newEl.placeholder = e.placeholder;
                        }
            
                        if (newEl.textContent
                            || newEl.placeholder
                            || newEl?.childNodesTexts.length > 0
                        ) {
                            elements.push(newEl);
                        }
                    }
                });
            
                let data = encodeURIComponent(JSON.stringify(elements, undefined, 4));
                exportLang.href = `data:text/plain;charset=utf-8,${data}`;
            }
            
            async function loadColours() {
                await loadColoursButton.files[0].text().then((content) => {
                    try {
                        /** @type {ColourScheme} */
                        let data = JSON.parse(content);
                        if (data) {
                            if (data.primary) {
                                colourChange('primary', data.primary);
                                primInput.value = data.primary;
                            }
                            if (data.secondary) {
                                colourChange('secondary', data.secondary);
                                secInput.value = data.secondary;
                            }
                            if (data.accent1) {
                                colourChange('accent1', data.accent1);
                                acc1Input.value = data.accent1;
                            }
                            if (data.accent2) {
                                colourChange('accent2', data.accent2);
                                acc2Input.value = data.accent2;
                            }
                        }
                    } catch (error) {
                        alert(
                            `Ошибка при чтении файла цветов: ${error}`
                        );
                    }
                });
            }
            
            function loadFont() {
                let font = localStorage.getItem('pageFont');
                document.getElementById('fontInput').value = font;
                document.documentElement.style.fontFamily = font;
            }
            
            /**
             * @typedef {Object} Translation
             * @property {string} name
             * @property {string[]} langTags
             * @property {LangElement[]} elements
             */
            /**
             * @param {Translation[]} languages
             */
            function generateLanguagesList(languages) {
                /** @type {HTMLSelectElement} */
                let list = document.body.insertBefore(
                    document.createElement('select'), settings
                );
                list.id = 'lang';
                list.style.borderRadius = '7px 0px 0px 7px';
                list.addEventListener('change', function (event) {
                    selectLanguage(languages, true);
                });
            
                for (let l of languages) {
                    /** @type {HTMLOptionElement} */
                    let option = list.appendChild(
                        document.createElement('option')
                    );
                    option.value = l.name;
                    option.textContent = l.name;
                }
            
                selectLanguage(languages, false);
            }
            
            /**
             * @param {Translation[]} languages
             * @param {boolean} fromMenu
             */
            function selectLanguage(languages, fromMenu) {
                /** @type {HTMLSelectElement} */
                let menu = document.getElementById('lang');
                /** @type {string} */
                let selection = undefined;
            
                if (fromMenu === false) {
                    if (localStorage.getItem('lang')) {
                        selection = localStorage.getItem('lang');
                        menu.value = selection;
                    } else if (navigator.language) {
                        // Iterate over translations
                        for (const l of languages) {
                            // If the valid option is finally found, exit
                            if (selection) {
                                break;
                            } else if (l.langTags) {
                                // Otherwise iterate over the tags and
                                // compare them to the browser language
                                for (const t of l.langTags) {
                                    if (navigator.language === t) {
                                        menu.value = l.name;
                                        selection = l.name;
                                        break;
                                    }
                                }
                            }
                        }
                    }
                } else {
                    selection = menu.value;
                }
            
                if (selection) {
                    /** @type {Translation} */
                    let translation = {};
            
                    for (const l of languages) {
                        if (l.name === selection) {
                            translation = l;
                            break;
                        }
                    }
            
                    if (translation) {
                        localStorage.setItem('lang', selection);
            
                        for (const e of translation.elements) {
                            let target = document.getElementById(e.id);
            
                            if (target) {
                                if (e.textContent) {
                                    target.textContent = e.textContent;
                                }
            
                                if (e.placeholder) {
                                    target.placeholder = e.placeholder;
                                }
            
                                if (e.childNodesTexts) {
                                    /** @type {number} */
                                    let index = 0;
            
                                    for (const c of target.childNodes) {
                                        if (c.textContent
                                            && c.textContent.trim() !== ''
                                            && e.childNodesTexts[index]
                                        ) {
                                            c.textContent = e.childNodesTexts[index];
                                            index ++;
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
            
            loadFont();

        </script>
        <script>
            // Elements
            /** @type {HTMLAnchorElement} */
            let saveWorksButton = document.getElementById('saveWorksButton');
            /** @type {HTMLAnchorElement} */
            let saveResultsButton = document.getElementById('saveResultsButton');
            /** @type {HTMLInputElement} */
            let loadWorksInput = document.getElementById('loadWorks');
            /** @type {HTMLButtonElement} */
            let addStudent = document.getElementById('student-add-button');
            /** @type {HTMLButtonElement} */
            let removeStudent = document.getElementById('student-remove-button');
            /** @type {HTMLTextAreaElement} */
            let sourceText = document.getElementById('source-text');
            /** @type {HTMLButtonElement} */
            let clearMistake = document.getElementById('clear-mistake-button');
            /** @type {HTMLInputElement} */
            let mistakeContent = document.getElementById('mistakeContent');
            /** @type {HTMLButtonElement} */
            let prevStud = document.getElementById('prev-stud');
            /** @type {HTMLButtonElement} */
            let nextStud = document.getElementById('next-stud');
            /** @type {HTMLInputElement} */
            let studentName = document.getElementById('student');
            /** @type {HTMLSpanElement} */
            let studentCount = document.getElementById('student-count');
            /** @type {HTMLTextAreaElement} */
            let work = document.getElementById('work');
            /** @type {HTMLDivElement} */
            let mistakes = document.getElementById('mistakes');
            /** @type {HTMLTableDataCellElement} */
            let resultsMistakeCount = document.getElementById('res-mistakes');
            /** @type {HTMLTableDataCellElement} */
            let resultsMistakeWeight = document.getElementById('res-weight');
            /** @type {HTMLTableDataCellElement} */
            let resultsMark = document.getElementById('res-mark');
            /** @type {HTMLButtonElement} */
            let copyMark = document.getElementById('copy-mark-button');

            // Constants
            const TYPE_GRAMMAR = 0
            const TYPE_VOCABULARY = 1
            const TYPE_ORTHOGRAPHY = 2
            const TYPE_PUNCTUATION = 3
            const TYPE_COMPLEX = 4

            const SUBTYPE_DELETION = 0
            const SUBTYPE_DISTORTION = 1
            const SUBTYPE_ADDITION = 2

            const MEANING_RETAINED = 0
            const MEANING_OBSCURED = 1
            const MEANING_LOST = 2

            // Types
            /** @typedef Mistake
             * @property content {string}
             * @property selection {[number, number]}
             * @property pos {number}
             * @property type {number}
             * @property subtype {number}
             * @property meaning {number}
            */
            /** @typedef Work
             * @property student {string}
             * @property text {string}
             * @property pos {number}
             * @property mistakes {Mistake[]}
             */

            // Variables
            /** @type {number} */
            let studentIndex = 0;
            /** @type {number} */
            let currentMark = 100;
            /** @type {Mistake} */
            let mistakeTemplate = {
                content: '',
                selection: [0, 0],
                pos: 0,
                type: TYPE_PUNCTUATION,
                subtype: SUBTYPE_DISTORTION,
                meaning: MEANING_RETAINED
            };
            /** @type {Work[]} */
            let works = [];

            updateStudent(0);

            addStudent.addEventListener('click', function (event) {
                /** @type {Work} */
                let newStudent = {
                    student: '',
                    text: '',
                    pos: 0,
                    mistakes: []
                };
                works.push(newStudent);
                studentIndex = works.length - 1;
                updateStudent(studentIndex);
            });

            removeStudent.addEventListener('click', function (event) {
                if (works.length === 0) return;

                works.splice(studentIndex, 1);
                if (works.length > 0) {
                    studentIndex = clamp(0, studentIndex, works.length - 1);
                } else {
                    /** @type {Work} */
                    let newStudent = {
                        student: '',
                        text: '',
                        pos: 0,
                        mistakes: []
                    };
                    works.push(newStudent);
                    studentIndex = 0;
                }
                updateStudent(studentIndex);
            });

            clearMistake.addEventListener('click', function (event) {
                mistakeContent.value = '';
                mistakeContent.focus();
                this.focus();
            });

            mistakeContent.addEventListener('input', function (event) {
                mistakeTemplate.content = this.value;
            });

            prevStud.addEventListener('click', function (event) {
                works[studentIndex].pos = work.scrollTop;
                studentIndex = clamp(0, studentIndex - 1, works.length - 1);
                updateStudent(studentIndex);
            });

            nextStud.addEventListener('click', function (event) {
                works[studentIndex].pos = work.scrollTop;
                studentIndex = clamp(0, studentIndex + 1, works.length - 1);
                updateStudent(studentIndex);
            });

            work.addEventListener('select', function (event) {
                let content = work.value.slice(
                    work.selectionStart, work.selectionEnd
                ).trim();
                mistakeContent.value = content;
                mistakeTemplate.content = content;
                mistakeTemplate.pos = work.scrollTop;
                mistakeTemplate.selection = [work.selectionStart, work.selectionEnd];
            });

            work.addEventListener('input', function (event) {
                works[studentIndex].text = this.value;
            });

            studentName.addEventListener('input', function (event) {
                works[studentIndex].student = this.value;
            });

            copyMark.addEventListener('click', function (event) {
                navigator.clipboard.writeText(currentMark);
            });

            function saveWorksFile() {
                let file = {
                    source: sourceText.value,
                    translations: works,
                    index: studentIndex
                };
                let data = encodeURIComponent(JSON.stringify(file, undefined, 2));
                saveWorksButton.download = 'Works.json';
                saveWorksButton.href = `data:text/plain;charset=utf-8,${data}`;
            }

            function saveResultsFile() {
                let results = `${
                    document.getElementById('page-title').textContent
                }\n${
                    document.getElementById('author').textContent
                }`;

                works.forEach((w, i) => {
                    updateStudent(i);

                    results += `\n\n${i + 1}. ${w.student}\n`;
                    results += `${
                        document.getElementById('res-mistakes-label').textContent
                    }: ${
                        resultsMistakeCount.textContent
                    }. ${
                        document.getElementById('res-weight-label').textContent
                    }: ${
                        resultsMistakeWeight.textContent
                    }. ${
                        document.getElementById('res-mark-label').textContent
                    }: ${
                        resultsMark.textContent
                    }:`;

                    let mIndex = 1;
                    let mistakes = document.getElementById('mistakes').getElementsByClassName('mistake');
                    for (let m of mistakes) {
                        if (m.childNodes && m.childNodes.length === 2) {
                            results += `\n  ${
                                mIndex
                            }) ${
                                m.childNodes[0].textContent
                            } [${
                                m.childNodes[1].textContent
                            }].`;
                        }
                        mIndex ++;
                    }
                });

                results = encodeURIComponent(results);
                saveResultsButton.download = 'Results.txt';
                saveResultsButton.href = `data:text/plain;charset=utf-8,${results}`;

                updateStudent(studentIndex);
            }

            async function loadWorksFile() {
                await loadWorksInput.files[0].text().then(content => {
                    try {
                        /** @type {
                            {
                                source: string,
                                translations: Works[],
                                index: number
                            }
                        }*/
                        let file = JSON.parse(content);
                        sourceText.value = file.source || '';
                        works = file.translations || [];
                        studentIndex = clamp(0, file.index || 0, works.length - 1);
                        updateStudent(studentIndex);
                    } catch (error) {
                        alert(`Error while reading works file: ${error}`);
                    }
                });
            }

            function sortStudents() {
                try {
                    works.sort((a, b) => a.student.localeCompare(b.student));
                    studentIndex = 0;
                    updateStudent(studentIndex);
                } catch (error) {
                    alert(`Error while sorting students: ${error}`);
                }
            }

            function updateStudent(index) {
                if (works.length === 0) {
                    /** @type {Work} */
                    let newStudent = {
                        student: '',
                        text: '',
                        pos: 0,
                        mistakes: []
                    };
                    works.push(newStudent);
                };

                if (!works[index]) {
                    index = works.length - 1;
                }

                let w = works[index];
                work.value = w.text || '';
                work.scrollTop = w.pos || 0;
                studentName.value = w.student || '';
                studentCount.textContent = `[${index + 1}/${works.length}]`;

                updateMistakes(index);
            }

            function updateMistakes(index) {
                while (mistakes.hasChildNodes()) mistakes.lastChild.remove();

                /** @type {Work} */
                let w = works[index];

                if (!w || !w.mistakes || w.mistakes.length == 0) {
                    work.readOnly = false;
                    resultsMistakeCount.textContent = 0;
                    resultsMistakeWeight.textContent = 0;
                    resultsMark.textContent = '100 (A)';
                    currentMark = 100;
                    return;
                } else {
                    work.readOnly = true;
                }

                /** @type {number} */
                let totalWeight = 0;
                /** @type {number} */
                let mark;
                /** @type {string} */
                let letter;

                w.mistakes.forEach((m, i) => {
                    // Manage mistake's weight
                    /** @type {number} */
                    let weight = 0;
                    /** @type {string} */
                    let typeText;
                    /** @type {string} */
                    let subtypeText;
                    /** @type {string} */
                    let meaningText;

                    switch (m.type) {
                        case TYPE_GRAMMAR:
                            weight = 4.25;
                            typeText = document.getElementById(
                                'type-gr'
                            ).outerText.toLowerCase();
                            break;
                        case TYPE_VOCABULARY:
                            weight = 3.5;
                            typeText = document.getElementById(
                                'type-voc'
                            ).outerText.toLowerCase();
                            break;
                        case TYPE_ORTHOGRAPHY:
                            weight = 3.25;
                            typeText = document.getElementById(
                                'type-orth'
                            ).outerText.toLowerCase();
                            break;
                        case TYPE_PUNCTUATION:
                            weight = 3;
                            typeText = document.getElementById(
                                'type-punc'
                            ).outerText.toLowerCase();
                            break;
                        case TYPE_COMPLEX:
                            weight = 7;
                            typeText = document.getElementById(
                                'type-comp'
                            ).outerText.toLowerCase();
                            break;
                        default:
                            break;
                    }

                    switch (m.subtype) {
                        case SUBTYPE_ADDITION:
                            subtypeText = document.getElementById(
                                'subtype-add'
                            ).outerText.toLowerCase();
                            break;
                        case SUBTYPE_DISTORTION:
                            subtypeText = document.getElementById(
                                'subtype-dis'
                            ).outerText.toLowerCase();
                            break;
                        case SUBTYPE_DELETION:
                            subtypeText = document.getElementById(
                                'subtype-del'
                            ).outerText.toLowerCase();
                            break;
                        default:
                            break;
                    }

                    switch (m.meaning) {
                        case MEANING_RETAINED:
                            meaningText = '';
                            break;
                        case MEANING_OBSCURED:
                            weight *= 1.5
                            meaningText = document.getElementById(
                                'meaning-obsc'
                            ).outerText.toLowerCase();
                            break;
                        case MEANING_LOST:
                            weight *= 2;
                            meaningText = document.getElementById(
                                'meaning-lost'
                            ).outerText.toLowerCase();
                            break;
                        default:
                            break;
                    }

                    totalWeight -= weight;

                    // Create elements
                    /** @type {HTMLDivElement} */
                    let container = mistakes.appendChild(
                        document.createElement('div')
                    );
                    container.classList.add('mistake-container');

                    /** @type {HTMLButtonElement} */
                    let remove = container.appendChild(
                        document.createElement('button')
                    );
                    remove.classList.add('remove', 'tooltipParent');
                    remove.textContent = '-';
                    remove.addEventListener('click', function (event) {
                        work.setSelectionRange(0, 0);
                        work.focus();
                        w.mistakes.splice(i, 1);
                        updateMistakes(studentIndex);
                    });

                    let tooltip = remove.appendChild(
                        document.createElement('span')
                    );
                    tooltip.classList.add('tooltip');
                    tooltip.textContent = document.getElementById(
                        'remove-mistake-tooltip'
                    ).textContent;

                    /** @type {HTMLButtonElement} */
                    let mistake = container.appendChild(
                        document.createElement('button')
                    );
                    mistake.style.display = 'block';
                    mistake.classList.add('mistake');
                    mistake.textContent = m.content;
                    mistake.addEventListener('click', function (event) {
                        work.focus();
                        work.scrollTop = m.pos;
                        work.setSelectionRange(m.selection[0], m.selection[1]);
                    });

                    let details = mistake.appendChild(
                        document.createElement('b')
                    );
                    details.style.marginLeft = '4px';
                    details.style.paddingLeft = '4px';
                    details.style.overflowWrap = 'anywhere';
                    details.style.borderLeft = '2px solid var(--accent1)';
                    details.textContent = `${
                        typeText
                    }, ${
                        subtypeText
                    }${
                        meaningText ? `, ${meaningText}` : ''
                    }; -${weight.toFixed(2)}`;
                });

                mark = Math.round(clamp(0, 100 + totalWeight, 100));
                currentMark = mark;

                if (mark > 94) letter = 'A';
                else if (mark > 82) letter = 'B';
                else if (mark > 67) letter = 'C';
                else if (mark > 55) letter = 'D';
                else if (mark > 49) letter = 'E';
                else if (mark > 19) letter = 'FX';
                else letter = 'F';

                resultsMistakeCount.textContent = w.mistakes.length;
                resultsMistakeWeight.textContent = (totalWeight * -1).toFixed(2);
                resultsMark.childNodes[0].textContent = `${mark} (${letter})`;
            }

            /**
             * @param {number} hiding
             * @param {number} showing
            */
            function hideDiv(hiding, showing) {
                if (mistakeContent.value === '') return;

                document.getElementById(
                    `add-mistake-${hiding}`
                ).style.display = 'none';

                document.getElementById(
                    `add-mistake-${showing}`
                ).style.display = 'flex';
            }

            function addType(mistakeType) {
                mistakeTemplate.type = mistakeType;
                hideDiv(1, 2);
            }

            function addSubtype(mistakeSubtype) {
                mistakeTemplate.subtype = mistakeSubtype;
                hideDiv(2, 3);
            }

            function addMeaning(mistakeMeaning) {
                mistakeTemplate.meaning = mistakeMeaning;

                /** @type {Mistake} */
                let newMistake = {
                    content: mistakeTemplate.content,
                    selection: mistakeTemplate.selection,
                    pos: mistakeTemplate.pos,
                    type: mistakeTemplate.type,
                    subtype: mistakeTemplate.subtype,
                    meaning: mistakeTemplate.meaning
                };

                /** @type {Work} */
                let w = works[studentIndex];

                if (!w.mistakes) w.mistakes = [];
                w.mistakes.push(newMistake);
                updateMistakes(studentIndex);
                hideDiv(3, 0);
            }

            /**
             * @param {number} min
             * @param {number} value
             * @param {number} max
            */
            function clamp(min, value, max) {
                return value < min
                    ? min
                    : value > max
                        ? max
                        : value;
            }

            generateLanguagesList([
                {
                    name: 'English [Vitaly Ulyanov]',
                    langTags: ['en', 'en-AU', 'en-BZ', 'en-CA', 'en-CB', 'en-GB', 'en-IE', 'en-JM', 'en-NZ', 'en-PH', 'en-TT', 'en-US', 'en-ZA', 'en-ZW'],
                    elements: [
                        {
                            "id": "page-title",
                            "childNodesTexts": [
                                "Marker"
                            ]
                        },
                        {
                            "id": "settings-summary",
                            "childNodesTexts": [
                                "Settings"
                            ]
                        },
                        {
                            "id": "fontLabel",
                            "childNodesTexts": [
                                "Font"
                            ]
                        },
                        {
                            "id": "fontInput",
                            "childNodesTexts": [],
                            "placeholder": "Type a font's name and press Enter"
                        },
                        {
                            "id": "primLabel",
                            "childNodesTexts": [
                                "Background colour"
                            ]
                        },
                        {
                            "id": "secLabel",
                            "childNodesTexts": [
                                "Text colour"
                            ]
                        },
                        {
                            "id": "acc1Label",
                            "childNodesTexts": [
                                "Accent colour 1"
                            ]
                        },
                        {
                            "id": "acc2Label",
                            "childNodesTexts": [
                                "Accent colour 2"
                            ]
                        },
                        {
                            "id": "loadLabel",
                            "childNodesTexts": [
                                "📁 Load colours"
                            ]
                        },
                        {
                            "id": "saveColoursButton",
                            "childNodesTexts": [
                                "💾 Save colours"
                            ]
                        },
                        {
                            "id": "exportLang",
                            "childNodesTexts": [
                                "🌐 Export texts for translation"
                            ]
                        },
                        {
                            "id": "menu-summary",
                            "childNodesTexts": [
                                "Menu"
                            ]
                        },
                        {
                            "id": "saveWorksButton",
                            "childNodesTexts": [
                                "Save",
                                "Save works to .json file"
                            ]
                        },
                        {
                            "id": "loadWorksButton",
                            "childNodesTexts": [
                                "Load",
                                "Load works from .json file"
                            ]
                        },
                        {
                            "id": "sort-button",
                            "childNodesTexts": [
                                "Sort",
                                "Sort students alphabetically"
                            ]
                        },
                        {
                            "id": "saveResultsButton",
                            "childNodesTexts": [
                                "Save results",
                                "Save results to .txt file"
                            ]
                        },
                        {
                            "id": "source-summary",
                            "childNodesTexts": [
                                "Source text"
                            ]
                        },
                        {
                            "id": "source-text",
                            "childNodesTexts": [],
                            "placeholder": "Text to translate"
                        },
                        {
                            "id": "clear-mistake-button",
                            "childNodesTexts": [
                                "-",
                                "Clear mistake's description"
                            ]
                        },
                        {
                            "id": "mistakeContent",
                            "childNodesTexts": [],
                            "placeholder": "Mistake"
                        },
                        {
                            "id": "next",
                            "childNodesTexts": [
                                "Next"
                            ]
                        },
                        {
                            "id": "type-gr",
                            "childNodesTexts": [
                                "Grammar"
                            ]
                        },
                        {
                            "id": "type-voc",
                            "childNodesTexts": [
                                "Vocabulary"
                            ]
                        },
                        {
                            "id": "type-orth",
                            "childNodesTexts": [
                                "Orthography"
                            ]
                        },
                        {
                            "id": "type-punc",
                            "childNodesTexts": [
                                "Punctuation"
                            ]
                        },
                        {
                            "id": "type-comp",
                            "childNodesTexts": [
                                "Complex"
                            ]
                        },
                        {
                            "id": "back-1",
                            "childNodesTexts": [
                                "Back"
                            ]
                        },
                        {
                            "id": "subtype-add",
                            "childNodesTexts": [
                                "Redundant element"
                            ]
                        },
                        {
                            "id": "subtype-dis",
                            "childNodesTexts": [
                                "Incorrect element"
                            ]
                        },
                        {
                            "id": "subtype-del",
                            "childNodesTexts": [
                                "Lack of element"
                            ]
                        },
                        {
                            "id": "back-2",
                            "childNodesTexts": [
                                "Back"
                            ]
                        },
                        {
                            "id": "cancel-2",
                            "childNodesTexts": [
                                "Cancel"
                            ]
                        },
                        {
                            "id": "meaning-ret",
                            "childNodesTexts": [
                                "Meaning retained"
                            ]
                        },
                        {
                            "id": "meaning-obsc",
                            "childNodesTexts": [
                                "Meaning obscured"
                            ]
                        },
                        {
                            "id": "meaning-lost",
                            "childNodesTexts": [
                                "Meaning lost"
                            ]
                        },
                        {
                            "id": "back-3",
                            "childNodesTexts": [
                                "Back"
                            ]
                        },
                        {
                            "id": "cancel-3",
                            "childNodesTexts": [
                                "Cancel"
                            ]
                        },
                        {
                            "id": "work",
                            "childNodesTexts": [],
                            "placeholder": "Student's translation"
                        },
                        {
                            "id": "prev-stud",
                            "childNodesTexts": [
                                "<",
                                "Previous student"
                            ]
                        },
                        {
                            "id": "student",
                            "childNodesTexts": [],
                            "placeholder": "Student"
                        },
                        {
                            "id": "student-add-button",
                            "childNodesTexts": [
                                "+",
                                "Add student"
                            ]
                        },
                        {
                            "id": "student-remove-button",
                            "childNodesTexts": [
                                "-",
                                "Remove student"
                            ]
                        },
                        {
                            "id": "next-stud",
                            "childNodesTexts": [
                                ">",
                                "Next student"
                            ]
                        },
                        {
                            "id": "mistakesHeader",
                            "childNodesTexts": [
                                "Mistakes:"
                            ]
                        },
                        {
                            "id": "remove-mistake-tooltip",
                            "childNodesTexts": [
                                "Remove mistake"
                            ]
                        },
                        {
                            "id": "results-header",
                            "childNodesTexts": [
                                "Results"
                            ]
                        },
                        {
                            "id": "res-mistakes-label",
                            "childNodesTexts": [
                                "Mistakes count"
                            ]
                        },
                        {
                            "id": "res-weight-label",
                            "childNodesTexts": [
                                "Mistakes weight"
                            ]
                        },
                        {
                            "id": "res-mark-label",
                            "childNodesTexts": [
                                "Mark"
                            ]
                        },
                        {
                            "id": "copy-mark-button",
                            "childNodesTexts": [
                                "Copy mark"
                            ]
                        },
                        {
                            "id": "help-summary",
                            "childNodesTexts": [
                                "Classification of mistakes"
                            ]
                        },
                        {
                            "id": "help-type",
                            "childNodesTexts": [
                                "Type",
                                ":"
                            ]
                        },
                        {
                            "id": "help-gr",
                            "childNodesTexts": [
                                "Grammar",
                                ": a mistake while conveying the meaning of a grammatical form (a wrong tense, article, declension, etc.)."
                            ]
                        },
                        {
                            "id": "help-voc",
                            "childNodesTexts": [
                                "Vocabulary",
                                ": a mistake while conveying the meaning of a word (a wrong word, collocation, style, etc.)."
                            ]
                        },
                        {
                            "id": "help-ort",
                            "childNodesTexts": [
                                "Orthography",
                                ": a wrong spelling of a word."
                            ]
                        },
                        {
                            "id": "help-pun",
                            "childNodesTexts": [
                                "Punctuation",
                                ": an incorrect usage of punctuation marks."
                            ]
                        },
                        {
                            "id": "help-com",
                            "childNodesTexts": [
                                "Complex",
                                ": a serious mistake or a combination of mistakes in a text unit larger than a character or a word (e.g., a phrase or a sentence)."
                            ]
                        },
                        {
                            "id": "help-subtype",
                            "childNodesTexts": [
                                "Subtype",
                                ":"
                            ]
                        },
                        {
                            "id": "help-red",
                            "childNodesTexts": [
                                "Redundant element",
                                ": a wrong extra element is inserted."
                            ]
                        },
                        {
                            "id": "help-inc",
                            "childNodesTexts": [
                                "Incorrect element",
                                ": a correct element is replaced with a wrong one."
                            ]
                        },
                        {
                            "id": "help-lack",
                            "childNodesTexts": [
                                "Lack of element",
                                ": a correct element is absent."
                            ]
                        },
                        {
                            "id": "help-meaning",
                            "childNodesTexts": [
                                "Text's meaning",
                                ":"
                            ]
                        },
                        {
                            "id": "help-ret",
                            "childNodesTexts": [
                                "Retained",
                                ": the mistake does not make understanding the text harder."
                            ]
                        },
                        {
                            "id": "help-obsc",
                            "childNodesTexts": [
                                "Obscured",
                                ": the text's meaning can be understood only with the help of the immediate context*."
                            ]
                        },
                        {
                            "id": "help-lost",
                            "childNodesTexts": [
                                "Lost",
                                ": the text's meaning is severely distorted and cannot be understood even with the help of the immediate context*."
                            ]
                        },
                        {
                            "id": "help-context",
                            "childNodesTexts": [
                                "*",
                                "Immediate context ",
                                "= ",
                                "everything before ",
                                "the analysed sentence + ",
                                "this sentence ",
                                "+ ",
                                "one sentence after ",
                                "it."
                            ]
                        },
                        {
                            "id": "author",
                            "childNodesTexts": [
                                "Made by Vitaly Pavlovich Ulyanov."
                            ]
                        },
                        {
                            "id": "fullscreenButton",
                            "childNodesTexts": [
                                "▲",
                                "Fullscreen"
                            ]
                        }
                    ]
                },
                {
                    name: 'Русский [Виталий Ульянов]',
                    langTags: ['ru', 'ru-RU'],
                    elements: [
                        {
                            "id": "page-title",
                            "childNodesTexts": [
                                "Баллбес"
                            ]
                        },
                        {
                            "id": "settings-summary",
                            "childNodesTexts": [
                                "Настройки"
                            ]
                        },
                        {
                            "id": "fontLabel",
                            "childNodesTexts": [
                                "Шрифт"
                            ]
                        },
                        {
                            "id": "fontInput",
                            "childNodesTexts": [],
                            "placeholder": "Введите название шрифта и нажмите Enter"
                        },
                        {
                            "id": "primLabel",
                            "childNodesTexts": [
                                "Цвет фона"
                            ]
                        },
                        {
                            "id": "secLabel",
                            "childNodesTexts": [
                                "Цвет текста"
                            ]
                        },
                        {
                            "id": "acc1Label",
                            "childNodesTexts": [
                                "Акцентный цвет 1"
                            ]
                        },
                        {
                            "id": "acc2Label",
                            "childNodesTexts": [
                                "Акцентный цвет 2"
                            ]
                        },
                        {
                            "id": "loadLabel",
                            "childNodesTexts": [
                                "📁 Загрузить цвета"
                            ]
                        },
                        {
                            "id": "saveColoursButton",
                            "childNodesTexts": [
                                "💾 Сохранить цвета"
                            ]
                        },
                        {
                            "id": "exportLang",
                            "childNodesTexts": [
                                "🌐 Экспортировать тексты для перевода"
                            ]
                        },
                        {
                            "id": "menu-summary",
                            "childNodesTexts": [
                                "Меню"
                            ]
                        },
                        {
                            "id": "saveWorksButton",
                            "childNodesTexts": [
                                "Сохранить",
                                "Сохранить работы в файл .json"
                            ]
                        },
                        {
                            "id": "loadWorksButton",
                            "childNodesTexts": [
                                "Загрузить",
                                "Загрузить работы из файла .json"
                            ]
                        },
                        {
                            "id": "sort-button",
                            "childNodesTexts": [
                                "Сортировать",
                                "Отсортировать студентов по алфавиту"
                            ]
                        },
                        {
                            "id": "saveResultsButton",
                            "childNodesTexts": [
                                "Сохранить итоги",
                                "Сохранить результаты в файл .txt"
                            ]
                        },
                        {
                            "id": "source-summary",
                            "childNodesTexts": [
                                "Исходный текст"
                            ]
                        },
                        {
                            "id": "source-text",
                            "childNodesTexts": [],
                            "placeholder": "Текст перевода"
                        },
                        {
                            "id": "clear-mistake-button",
                            "childNodesTexts": [
                                "-",
                                "Очистить описание ошибки"
                            ]
                        },
                        {
                            "id": "mistakeContent",
                            "childNodesTexts": [],
                            "placeholder": "Ошибка"
                        },
                        {
                            "id": "next",
                            "childNodesTexts": [
                                "Далее"
                            ]
                        },
                        {
                            "id": "type-gr",
                            "childNodesTexts": [
                                "Грамматическая"
                            ]
                        },
                        {
                            "id": "type-voc",
                            "childNodesTexts": [
                                "Лексическая"
                            ]
                        },
                        {
                            "id": "type-orth",
                            "childNodesTexts": [
                                "Орфографическая"
                            ]
                        },
                        {
                            "id": "type-punc",
                            "childNodesTexts": [
                                "Пунктуационная"
                            ]
                        },
                        {
                            "id": "type-comp",
                            "childNodesTexts": [
                                "Комплексная"
                            ]
                        },
                        {
                            "id": "back-1",
                            "childNodesTexts": [
                                "Назад"
                            ]
                        },
                        {
                            "id": "subtype-add",
                            "childNodesTexts": [
                                "Лишний элемент"
                            ]
                        },
                        {
                            "id": "subtype-dis",
                            "childNodesTexts": [
                                "Неверный элемент"
                            ]
                        },
                        {
                            "id": "subtype-del",
                            "childNodesTexts": [
                                "Отсутствие элемента"
                            ]
                        },
                        {
                            "id": "back-2",
                            "childNodesTexts": [
                                "Назад"
                            ]
                        },
                        {
                            "id": "cancel-2",
                            "childNodesTexts": [
                                "Отмена"
                            ]
                        },
                        {
                            "id": "meaning-ret",
                            "childNodesTexts": [
                                "Понимание не затруднено"
                            ]
                        },
                        {
                            "id": "meaning-obsc",
                            "childNodesTexts": [
                                "Понимание затруднено"
                            ]
                        },
                        {
                            "id": "meaning-lost",
                            "childNodesTexts": [
                                "Понимание невозможно"
                            ]
                        },
                        {
                            "id": "back-3",
                            "childNodesTexts": [
                                "Назад"
                            ]
                        },
                        {
                            "id": "cancel-3",
                            "childNodesTexts": [
                                "Отмена"
                            ]
                        },
                        {
                            "id": "work",
                            "childNodesTexts": [],
                            "placeholder": "Перевод студента"
                        },
                        {
                            "id": "prev-stud",
                            "childNodesTexts": [
                                "<",
                                "Предыдущий студент"
                            ]
                        },
                        {
                            "id": "student",
                            "childNodesTexts": [],
                            "placeholder": "Студент"
                        },
                        {
                            "id": "student-add-button",
                            "childNodesTexts": [
                                "+",
                                "Добавить студента"
                            ]
                        },
                        {
                            "id": "student-remove-button",
                            "childNodesTexts": [
                                "-",
                                "Удалить студента"
                            ]
                        },
                        {
                            "id": "next-stud",
                            "childNodesTexts": [
                                ">",
                                "Следующий студент"
                            ]
                        },
                        {
                            "id": "mistakesHeader",
                            "childNodesTexts": [
                                "Ошибки:"
                            ]
                        },
                        {
                            "id": "remove-mistake-tooltip",
                            "childNodesTexts": [
                                "Удалить ошибку"
                            ]
                        },
                        {
                            "id": "results-header",
                            "childNodesTexts": [
                                "Результаты"
                            ]
                        },
                        {
                            "id": "res-mistakes-label",
                            "childNodesTexts": [
                                "Число ошибок"
                            ]
                        },
                        {
                            "id": "res-weight-label",
                            "childNodesTexts": [
                                "Вес ошибок"
                            ]
                        },
                        {
                            "id": "res-mark-label",
                            "childNodesTexts": [
                                "Оценка"
                            ]
                        },
                        {
                            "id": "copy-mark-button",
                            "childNodesTexts": [
                                "Копировать балл"
                            ]
                        },
                        {
                            "id": "help-summary",
                            "childNodesTexts": [
                                "Классификация ошибок"
                            ]
                        },
                        {
                            "id": "help-type",
                            "childNodesTexts": [
                                "Вид",
                                ":"
                            ]
                        },
                        {
                            "id": "help-gr",
                            "childNodesTexts": [
                                "Грамматическая",
                                " — ошибка в передаче значения грамматической формы (неверное время, склонение, спряжение, артикль и т.п.)."
                            ]
                        },
                        {
                            "id": "help-voc",
                            "childNodesTexts": [
                                "Лексическая",
                                " — ошибка в передаче значения слова (неверное слово, сочетаемость, стиль и т.п.)."
                            ]
                        },
                        {
                            "id": "help-ort",
                            "childNodesTexts": [
                                "Орфографическая",
                                " — ошибка в написании слова."
                            ]
                        },
                        {
                            "id": "help-pun",
                            "childNodesTexts": [
                                "Пунктуационная",
                                " — ошибка в расстановке знаков препинания."
                            ]
                        },
                        {
                            "id": "help-com",
                            "childNodesTexts": [
                                "Комплексная",
                                " — грубая ошибка или сочетание ошибок при переводе большей, чем знак или слово, единицы текста (словосочетания, предложения)."
                            ]
                        },
                        {
                            "id": "help-subtype",
                            "childNodesTexts": [
                                "Подвид",
                                ":"
                            ]
                        },
                        {
                            "id": "help-red",
                            "childNodesTexts": [
                                "Лишний элемент",
                                " — привнесение ненужного элемента."
                            ]
                        },
                        {
                            "id": "help-inc",
                            "childNodesTexts": [
                                "Неверный элемент",
                                " — замена правильного элемента неправильным."
                            ]
                        },
                        {
                            "id": "help-lack",
                            "childNodesTexts": [
                                "Отсутствие элемента",
                                " — недостаток нужного элемента."
                            ]
                        },
                        {
                            "id": "help-meaning",
                            "childNodesTexts": [
                                "Понимание текста",
                                ":"
                            ]
                        },
                        {
                            "id": "help-ret",
                            "childNodesTexts": [
                                "Не затруднено",
                                " — ошибка не усложняет понимание текста."
                            ]
                        },
                        {
                            "id": "help-obsc",
                            "childNodesTexts": [
                                "Затруднено",
                                " — понимание текста возможно только при обращении к ближайшему контексту*."
                            ]
                        },
                        {
                            "id": "help-lost",
                            "childNodesTexts": [
                                "Невозможно",
                                " — смысл сильно искажён, понимание текста невозможно даже при обращении к ближайшему контексту*."
                            ]
                        },
                        {
                            "id": "help-context",
                            "childNodesTexts": [
                                "*",
                                "Ближайший контекст ",
                                "= ",
                                "всё до ",
                                "анализируемого предложения + ",
                                "это предложение ",
                                "+ ",
                                "одно предложение после ",
                                "него."
                            ]
                        },
                        {
                            "id": "author",
                            "childNodesTexts": [
                                "Автор — Виталий Павлович Ульянов."
                            ]
                        },
                        {
                            "id": "fullscreenButton",
                            "childNodesTexts": [
                                "▲",
                                "Полный экран"
                            ]
                        }
                    ]
                }
            ]);
        </script>
    </body>
</html>
